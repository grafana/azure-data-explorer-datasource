define(["lodash","app/core/config","moment","app/plugins/sdk","angular"],function(t,e,r,n,a){return s={},o.m=i=[function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e){t.exports=r},function(t,e){t.exports=n},function(t,e){t.exports=a},function(t,e,r){"use strict";r.r(e);var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=(u.prototype.parseDatabases=function(t){var e=[];if(!t||!t.data||!t.data.Tables||0===t.data.Tables.length)return e;for(var r=0,n=t.data.Tables;r<n.length;r++)for(var a=0,o=n[r].Rows;a<o.length;a++){var i=o[a];e.push({text:i[5]||i[0],value:i[0]})}return e},u.prototype.parseSchemaResult=function(t){var e=t.Tables[0].Rows[0][0];return JSON.parse(e)},u.prototype.parseQueryResult=function(t){for(var e=[],r=[],n=0;n<t.length;n++)if(0!==t[n].result.data.Tables.length){r=t[n].result.data.Tables[0].Columns;var o=t[n].result.data.Tables[0].Rows;e="time_series"===t[n].query.resultFormat?a.a.concat(e,this.parseTimeSeriesResult(t[n].query,r,o)):a.a.concat(e,this.parseTableResult(t[n].query,r,o))}return{data:e}},u.prototype.parseTimeSeriesResult=function(t,e,r){for(var n=[],a=-1,o=-1,i=-1,s=0;s<e.length;s++)-1===a&&"datetime"===e[s].ColumnType&&(a=s),-1===o&&"string"===e[s].ColumnType&&(o=s),-1===i&&["int","long","real","double"].includes(e[s].ColumnType)&&(i=s);if(-1===a)throw new Error("No datetime column found in the result. The Time Series format requires a time column.");for(var l=0,c=r;l<c.length;l++){var d=c[l],h=u.dateTimeToEpoch(d[a]),f=-1<o?d[o]:e[i].name,p=u.findOrCreateBucket(n,f);p.datapoints.push([d[i],h]),p.refId=t.refId,p.query=t.query}return n},u.prototype.parseTableResult=function(t,e,r){return{type:"table",columns:a.a.map(e,function(t){return{text:t.ColumnName,type:t.ColumnType}}),rows:r,refId:t.refId,query:t.query}},u.prototype.parseToVariables=function(t){for(var e=[],r=0,n=this.parseQueryResult(t).data;r<n.length;r++)for(var o=n[r],i=0,s=a.a.flattenDeep(o.rows);i<s.length;i++){var u=s[i];e.push({text:u,value:u})}return e},u.prototype.transformToAnnotations=function(t,e){for(var r=[],n=0,a=this.parseQueryResult(e).data;n<a.length;n++){for(var o=a[n],i=-1,s=-1,l=-1,c=0;c<o.columns.length;c++)-1===i&&"datetime"===o.columns[c].type&&(i=c),-1===s&&"text"===o.columns[c].text.toLowerCase()&&(s=c),-1===l&&"tags"===o.columns[c].text.toLowerCase()&&(l=c);for(var d=0,h=o.rows;d<h.length;d++){var f=h[d];r.push({annotation:t.annotation,time:Math.floor(u.dateTimeToEpoch(f[i])),text:f[s]?f[s].toString():"",tags:f[l]?f[l].trim().split(/\s*,\s*/):[]})}}return r},u.findOrCreateBucket=function(t,e){var r=a.a.find(t,["target",e]);return r||(r={target:e,datapoints:[],refId:"",query:""},t.push(r)),r},u.dateTimeToEpoch=function(t){return i()(t).valueOf()},u);function u(){}function l(t,e){this.rawQuery=t,this.options=e}var c=(l.prototype.interpolate=function(){var t=this;if(!this.rawQuery)return{query:""};var e=this.rawQuery,r=/\$__([_a-zA-Z0-9]+)\(([^\)]*)\)/gi;if(e=(e=e.replace(r,function(e,r,n){return"contains"===r?t.getMultiContains(n):e})).replace(/\$__escapeMulti\(('[^]*')\)/gi,function(e,r){return t.escape(r)}),this.options){var n="";if(e=(e=(e=(e=e.replace(r,function(e,r,a){return"timeFilter"===r?(n=a.trim(),t.getTimeFilter(a,t.options)):e})).replace(/\$__interval/gi,this.options.interval)).replace(/\$__from/gi,this.getFrom(this.options))).replace(/\$__to/gi,this.getUntil(this.options)),!/order\s+by/gi.test(e)){if(!n){var a=/bin\(([_a-zA-Z0-9]+),/.exec(e);n=a?a[1]:""}n&&(e+="\n| order by "+n+" asc")}}return{query:e}},l.prototype.getFrom=function(t){var e=t.range.from;return"datetime("+i()(e).startOf("minute").toISOString()+")"},l.prototype.getUntil=function(t){if("now"===t.rangeRaw.to)return"now()";var e=t.range.to;return"datetime("+i()(e).startOf("minute").toISOString()+")"},l.prototype.getTimeFilter=function(t,e){return"now"===e.rangeRaw.to?t+" >= "+this.getFrom(e):t+"  >= "+this.getFrom(e)+" and "+t+" <= "+this.getUntil(e)},l.prototype.getMultiContains=function(t){var e=t.indexOf(","),r=t.substring(0,e),n=t.substring(t.indexOf(",")+1);return n&&"all"===n.toLowerCase().trim()?"1 == 1":r.trim()+" in ("+n.trim()+")"},l.prototype.escape=function(t){return t.substring(1,t.length-1).split("','").map(function(t){return"@'"+t+"'"}).join(", ")},l);function d(t){void 0===t&&(t={ttl:1e4}),this.opts=t,this.store={}}var h=(d.prototype.put=function(t,e,r){var n=this;void 0===r&&(r=this.opts.ttl),void 0!==t&&void 0!==e&&(this.del(t),this.store[t]={value:e,expire:Date.now()+r,timeout:setTimeout(function(){n.del(t)},r)})},d.prototype.get=function(t){var e=this.store[t];return e&&e.expire&&e.expire<=Date.now()&&(this.del(t),e=void 0),e&&e.value},d.prototype.del=function(t){this.store.hasOwnProperty(t)&&(clearTimeout(this.store[t].timeout),delete this.store[t])},d),f=function(t,e,r,n){return new(r=r||Promise)(function(a,o){function i(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?a(t.value):new r(function(e){e(t.value)}).then(i,s)}u((n=n.apply(t,e||[])).next())})},p=function(t,e){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=0<(a=i.trys).length&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};function m(t){this.backendSrv=t,this.ongoingRequests={}}var g=(m.prototype.doRequest=function(t,e,r){return void 0===r&&(r=1),f(this,void 0,void 0,function(){var n=this;return p(this,function(a){return[2,this.backendSrv.datasourceRequest({url:t,method:"POST",data:e}).catch(function(a){if(0<r)return n.doRequest(t,e,r-1);throw a})]})})},m.prototype.dsPost=function(t,e,r){return f(this,void 0,void 0,function(){var n=this;return p(this,function(a){return this.ongoingRequests.hasOwnProperty(t)||(this.ongoingRequests[t]=new Promise(function(a,o){return f(n,void 0,void 0,function(){var n,i;return p(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,3,4]),[4,this.doRequest(e,r)];case 1:return n=s.sent(),a(n),[3,4];case 2:return i=s.sent(),o(i),[3,4];case 3:return delete this.ongoingRequests[t],[7];case 4:return[2]}})})})),[2,this.ongoingRequests[t]]})})},m),y=(b.$inject=["instanceSettings","backendSrv","$q","templateSrv"],b.prototype.query=function(t){var e=this,r=a.a.filter(t.targets,function(t){return!0!==t.hide&&t.query&&-1===t.query.indexOf("<table name>")}).map(function(r){var n=e.baseUrl+"/v1/rest/query",a=new c(e.templateSrv.replace(r.query,t.scopedVars,e.interpolateVariable),t).interpolate().query;return{key:n+"-"+t.intervalMs+"-"+t.maxDataPoints+"-"+t.format+"-"+r.resultFormat+"-"+a,refId:r.refId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:e.id,url:n,query:a,format:t.format,resultFormat:r.resultFormat,data:{csl:a,db:r.database}}});if(!r||0===r.length)return{data:[]};var n=this.doQueries(r);return this.$q.all(n).then(function(t){return(new s).parseQueryResult(t)})},b.prototype.annotationQuery=function(t){if(!t.annotation.rawQuery)return this.$q.reject({message:"Query missing in annotation definition"});var e=this.buildQuery(t.annotation.rawQuery,t,t.annotation.database),r=this.doQueries(e);return this.$q.all(r).then(function(e){return(new s).transformToAnnotations(t,e)})},b.prototype.metricFindQuery=function(t){var e=this;return this.getDefaultOrFirstDatabase().then(function(r){var n=e.buildQuery(t,null,r),a=e.doQueries(n);return e.$q.all(a).then(function(t){return(new s).parseToVariables(t)}).catch(function(t){if(t.error&&t.error.data&&t.error.data.error)throw{message:t.error.data.error["@message"]}})})},b.prototype.testDatasource=function(){var t=this;return this.testDatasourceConnection().then(function(){return t.testDatasourceAccess()}).catch(function(t){return{status:"error",message:t.message+" Connection to database could not be established."}})},b.prototype.testDatasourceConnection=function(){var t=this.baseUrl+"/v1/rest/mgmt";return this.doRequest(t,{csl:".show databases"}).then(function(t){return 200===t.status?{status:"success",message:"Successfully queried the Azure Data Explorer database.",title:"Success"}:{status:"error",message:"Returned http status code "+t.status}}).catch(function(t){var e="Azure Data Explorer: ";return e+=t.statusText?t.statusText+": ":"",t.data&&t.data.Message?e+=t.data.Message:t.data?e+=t.data:e+="Cannot connect to the Azure Data Explorer REST API.",{status:"error",message:e}})},b.prototype.testDatasourceAccess=function(){var t=this.baseUrl+"/v1/rest/mgmt";return this.doRequest(t,{csl:".show databases schema"}).then(function(t){return 200===t.status?{status:"success",message:"Successfully queried the Azure Data Explorer database.",title:"Success"}:{status:"error",message:"Returned http status code "+t.status}}).catch(function(t){var e="Azure Data Explorer: Cannot read database schema from REST API. ";return e+=t.statusText?t.statusText+": ":"",t.data&&t.data.error&&t.data.error["@message"]?e+=t.data.error&&t.data.error["@message"]:t.data?e+=JSON.stringify(t.data):e+="Cannot read database schema from Azure Data Explorer REST API.",{status:"error",message:e}})},b.prototype.getDatabases=function(){var t=this.baseUrl+"/v1/rest/mgmt";return this.doRequest(t,{csl:".show databases"}).then(function(t){return(new s).parseDatabases(t)})},b.prototype.getDefaultOrFirstDatabase=function(){var t=this;return this.defaultOrFirstDatabase?Promise.resolve(this.defaultOrFirstDatabase):this.getDatabases().then(function(e){return t.defaultOrFirstDatabase=e[0].value,t.defaultOrFirstDatabase})},b.prototype.getSchema=function(t){var e=this.baseUrl+"/v1/rest/mgmt",r={csl:".show database ["+t+"] schema as json"};return this.doRequest(e,r).then(function(t){return(new s).parseSchemaResult(t.data)})},b.prototype.doQueries=function(t){var e=this;return t.map(function(t){return e.cache.get(t.key)||e.requestAggregatorSrv.dsPost(t.key,e.url+t.url,t.data).then(function(r){var n={result:r,query:t};return t.key&&e.cache.put(t.key,n),n}).catch(function(e){throw{error:e,query:t}})})},b.prototype.buildQuery=function(t,e,r){var n=new c(this.templateSrv.replace(t,{},this.interpolateVariable),e),a=this.baseUrl+"/v1/rest/query",o=n.interpolate().query,i=[];return i.push({key:a+"-table-"+r+"-"+o,datasourceId:this.id,url:a,resultFormat:"table",data:{csl:o,db:r}}),i},b.prototype.doRequest=function(t,e,r){var n=this;return void 0===r&&(r=1),this.backendSrv.datasourceRequest({url:this.url+t,method:"POST",data:e}).catch(function(a){if(0<r)return n.doRequest(t,e,r-1);throw a})},b.prototype.interpolateVariable=function(t,e){return"string"==typeof t?e.multi||e.includeAll?"'"+t+"'":t:"number"==typeof t?t:a.a.map(t,function(e){return"number"==typeof t?t:"'"+e+"'"}).join(",")},b.prototype.getCacheTtl=function(t){if(void 0===t.jsonData.minimalCache)return 3e4;if(t.jsonData.minimalCache<1)throw new Error("Minimal cache must be greater than or equal to 1.");return 1e3*t.jsonData.minimalCache},b);function b(t,e,r,n){this.backendSrv=e,this.$q=r,this.templateSrv=n,this.name=t.name,this.id=t.id,this.baseUrl="/azuredataexplorer",this.url=t.url,this.defaultOrFirstDatabase=t.jsonData.defaultDatabase,this.cache=new h({ttl:this.getCacheTtl(t)}),this.requestAggregatorSrv=new g(e)}var v=r(3),w=r(4),C=r.n(w);function D(t,e,r,n){this.containerDiv=t,this.defaultTimeField=e,this.getSchema=r,this.config=n,this.splitWithNewLineRegex=/[^\n]+\n?|\n/g,this.newLineRegex=/\r?\n/,this.startsWithKustoPipeRegex=/^\|\s*/g,this.kustoPipeRegexStrict=/^\|\s*$/g}var T=(D.prototype.initMonaco=function(t){var e=this,r=this.config.bootData.user.lightTheme?"grafana-light":"vs-dark";monaco.editor.defineTheme("grafana-light",{base:"vs",inherit:!0,rules:[{token:"comment",foreground:"008000"},{token:"variable.predefined",foreground:"800080"},{token:"function",foreground:"0000FF"},{token:"operator.sql",foreground:"FF4500"},{token:"string",foreground:"B22222"},{token:"operator.scss",foreground:"0000FF"},{token:"variable",foreground:"C71585"},{token:"variable.parameter",foreground:"9932CC"},{token:"",foreground:"000000"},{token:"type",foreground:"0000FF"},{token:"tag",foreground:"0000FF"},{token:"annotation",foreground:"2B91AF"},{token:"keyword",foreground:"0000FF"},{token:"number",foreground:"191970"},{token:"annotation",foreground:"9400D3"},{token:"invalid",background:"cd3131"}],colors:{"textCodeBlock.background":"#FFFFFF"}}),monaco.languages.kusto.kustoDefaults.setLanguageSettings({includeControlCommands:!0,newlineAfterPipe:!0,useIntellisenseV2:!1}),this.codeEditor=monaco.editor.create(this.containerDiv,{value:t.content||"Write your query here",language:"kusto",selectionHighlight:!1,theme:r,folding:!0,lineNumbers:"off",lineHeight:16,suggestFontSize:13,dragAndDrop:!1,occurrencesHighlight:!1,minimap:{enabled:!1},renderIndentGuides:!1,wordWrap:"on"}),this.codeEditor.layout(),1===monaco.editor.getModels().length&&(this.completionItemProvider=monaco.languages.registerCompletionItemProvider("kusto",{triggerCharacters:["."," "],provideCompletionItems:this.getCompletionItems.bind(this)}),this.signatureHelpProvider=monaco.languages.registerSignatureHelpProvider("kusto",{signatureHelpTriggerCharacters:["(",")"],provideSignatureHelp:this.getSignatureHelp.bind(this)})),this.codeEditor.createContextKey("readyToExecute",!0),this.codeEditor.onDidChangeCursorSelection(function(t){e.onDidChangeCursorSelection(t)}),this.getSchema().then(function(t){t&&monaco.languages.kusto.getKustoWorker().then(function(r){var n=e.codeEditor.getModel();n&&r(n.uri).then(function(r){var n=0<Object.keys(t.Databases).length?Object.keys(t.Databases)[0]:"";r.setSchemaFromShowSchema(t,"https://help.kusto.windows.net",n),e.codeEditor.layout()})})})},D.prototype.setOnDidChangeModelContent=function(t){this.codeEditor.onDidChangeModelContent(t)},D.prototype.disposeMonaco=function(){if(this.completionItemProvider)try{this.completionItemProvider.dispose()}catch(t){console.error("Failed to dispose the completion item provider.",t)}if(this.signatureHelpProvider)try{this.signatureHelpProvider.dispose()}catch(t){console.error("Failed to dispose the signature help provider.",t)}if(this.codeEditor)try{this.codeEditor.dispose()}catch(t){console.error("Failed to dispose the editor component.",t)}},D.prototype.addCommand=function(t,e){this.codeEditor.addCommand(t,e,"readyToExecute")},D.prototype.getValue=function(){return this.codeEditor.getValue()},D.prototype.toSuggestionController=function(t){return t},D.prototype.setEditorContent=function(t){this.codeEditor.setValue(t)},D.prototype.getCompletionItems=function(t,e){var r="##### Macro that uses the selected timerange in Grafana to filter the query.\n\n- `$__timeFilter()` -> Uses the "+this.defaultTimeField+" column\n\n- `$__timeFilter(datetimeColumn)` ->  Uses the specified datetime column to build the query.",n=t.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:e.lineNumber,endColumn:e.column});return a.a.includes(n,"|")?a.a.includes(n.toLowerCase(),"where")?a.a.includes(t.getLineContent(e.lineNumber).toLowerCase(),"where")?[{label:"$__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:r}},{label:"$__from",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__from"},documentation:{value:"Built-in variable that returns the from value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" > $__from` "}},{label:"$__to",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__to"},documentation:{value:"Built-in variable that returns the to value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" < $__to` "}},{label:"$__interval",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__interval"},documentation:{value:"##### Built-in variable that returns an automatic time grain suitable for the current timerange.\n\nUsed with the bin() function - `bin("+this.defaultTimeField+", $__interval)` \n\n[Grafana docs](http://docs.grafana.org/reference/templating/#the-interval-variable)"}}]:[]:[{label:"where $__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"where \\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:r}}]:[]},D.prototype.getSignatureHelp=function(t,e,r){return"$__timeFilter("!==t.getValueInRange({startLineNumber:e.lineNumber,startColumn:e.column-14,endLineNumber:e.lineNumber,endColumn:e.column})?{}:{activeParameter:0,activeSignature:0,signatures:[{label:"$__timeFilter(timeColumn)",parameters:[{label:"timeColumn",documentation:"Default is "+this.defaultTimeField+" column. Datetime column to filter data using the selected date range. "}]}]}},D.prototype.onDidChangeCursorSelection=function(t){"modelChange"===t.source&&t.reason===monaco.editor.CursorChangeReason.RecoverFromMarkers&&" "===this.getCharAt(t.selection.positionLineNumber,t.selection.positionColumn-1)&&this.triggerSuggestions()},D.prototype.triggerSuggestions=function(){var t=this.codeEditor.getContribution("editor.contrib.suggestController");if(t){var e=this.toSuggestionController(t);e._model.cancel(),setTimeout(function(){e._model.trigger(!0)},10)}},D.prototype.getCharAt=function(t,e){var r=this.codeEditor.getModel();if(!r)return"";if(0===r.getLineCount()||r.getLineCount()<t)return"";var n=r.getLineContent(t);return n.length<e||e<1?"":n[e-1]},D),_=r(1),S=r.n(_);function F(t,e,r){var n=e.find("#content")[0];function a(t,e){var r=new T(t,e.defaultTimeField,e.getSchema,S.a);r.initMonaco(e),r.addCommand(monaco.KeyMod.Shift|monaco.KeyCode.Enter,function(){var t=r.getValue();e.content=t,e.onChange()}),e.$watch("content",function(t,n){var a=r.getValue();t!==a&&t!==n&&e.$$postDigest(function(){r.setEditorContent(t)})}),r.setOnDidChangeModelContent(function(){e.$apply(function(){var t=r.getValue();e.content=t})}),e.$on("$destroy",function(){r.disposeMonaco()})}window.monaco?setTimeout(function(){a(n,t)},1):window.System.import("/"+t.pluginBaseUrl+"/lib/monaco.min.js").then(function(){setTimeout(function(){a(n,t)},1)}),n.onblur=function(){t.onChange()},n.onkeydown=function(t){if("Escape"===t.key)return t.stopPropagation(),!0}}C.a.module("grafana.controllers").directive("kustoMonacoEditor",function(){return{restrict:"E",template:'<div id="content" tabindex="0" style="width: 100%; height: 150px"></div>',scope:{content:"=",onChange:"&",getSchema:"&",defaultTimeField:"@",pluginBaseUrl:"@"},link:F}});var q,x,k=((q=function(t,e){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}q(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)})(E,x=v.QueryCtrl),E.$inject=["$scope","$injector"],E.prototype.onDataReceived=function(t){this.lastQueryError=void 0,this.lastQuery="";var e=a.a.find(t,{refId:this.target.refId});e&&(this.lastQuery=e.query)},E.prototype.onDataError=function(t){this.handleQueryCtrlError(t)},E.prototype.handleQueryCtrlError=function(t){t.query&&t.query.refId&&t.query.refId!==this.target.refId||(t.error&&t.error.data&&t.error.data.error&&t.error.data.error.innererror?t.error.data.error.innererror.innererror?this.lastQueryError=t.error.data.error.innererror.innererror.message:this.lastQueryError=t.error.data.error.innererror["@message"]:t.error&&t.error.data&&t.error.data.error?this.lastQueryError=t.error.data.error.message:t.error&&t.error.data?this.lastQueryError=t.error.data.message:t.data&&t.data.error?this.lastQueryError=t.data.error.message:t.data&&t.data.message?this.lastQueryError=t.data.message:this.lastQueryError=t)},E.prototype.getDatabases=function(){var t=this;return this.datasource.getDatabases().then(function(e){0<(t.databases=e).length&&!t.target.database&&(t.target.database=t.datasource.defaultOrFirstDatabase||e[0].value)})},E.prototype.getSchema=function(){var t=this;return this.getDatabases().then(function(){return t.datasource.getSchema(t.target.database)})},E.templateUrl="partials/query.editor.html",E);function E(t,e){var r=x.call(this,t,e)||this;return r.defaults={query:["//change this to create your own time series query","","<table name>","| where $__timeFilter(Timestamp)","// | summarize count() by <group by column>, bin(Timestamp, $__interval)","// | order by Timestamp asc"].join("\n"),resultFormat:"time_series",database:""},a.a.defaultsDeep(r.target,r.defaults),r.panelCtrl.events.on("data-received",r.onDataReceived.bind(r),t),r.panelCtrl.events.on("data-error",r.onDataError.bind(r),t),r.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],r.getDatabases(),r}var R=($.prototype.getDatabases=function(){var t=this;return this.databases&&0<this.databases.length?this.databases:this.datasource.getDatabases().then(function(e){return 0<(t.databases=e).length&&!t.annotation.database&&(t.annotation.database=e[0].value),t.databases}).catch(function(){})},$.templateUrl="partials/annotations.editor.html",$);function $(){this.showHelp=!1,this.defaultQuery='<your table>\n| where $__timeFilter() \n| project TimeGenerated, Text=YourTitleColumn, Tags="tag1,tag2"',this.annotation.rawQuery=this.annotation.rawQuery||this.defaultQuery,this.databases=this.getDatabases()}var O=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/,I=(Q.prototype.isGtOrEq=function(t){for(var e=new Q(t),r=0;r<this.comparable.length;++r){if(this.comparable[r]>e.comparable[r])return!0;if(this.comparable[r]<e.comparable[r])return!1}return!0},Q.prototype.isValid=function(){return a.a.isNumber(this.major)},Object.defineProperty(Q.prototype,"comparable",{get:function(){return[this.major,this.minor,this.patch]},enumerable:!0,configurable:!0}),Q);function Q(t){var e=O.exec(t);e&&(this.major=Number(e[1]),this.minor=Number(e[2]||0),this.patch=Number(e[3]||0),this.meta=e[4])}var P=(j.$inject=["$scope","backendSrv","$q"],j.prototype.getDatabases=function(){var t=this;return this.kustoDbDatasource.getDatabases().then(function(e){t.databases=e,0<t.databases.length&&(t.current.jsonData.defaultDatabase=t.current.jsonData.defaultDatabase||t.databases[0].value)})},j.prototype.hasMinVersion=function(){return function(t,e){return new I(t).isGtOrEq("5.3")}(S.a.buildInfo.latestVersion)||"5.3.0-beta1"===S.a.buildInfo.version||"5.3.0-pre1"===S.a.buildInfo.version},j.prototype.showMinVersionWarning=function(){return!this.hasRequiredGrafanaVersion},j.templateUrl="partials/config.html",j);function j(t,e,r){var n=this;this.hasRequiredGrafanaVersion=this.hasMinVersion(),this.suggestUrl="https://yourcluster.kusto.windows.net",t.getSuggestUrls=function(){return[n.suggestUrl]},this.current.id&&(this.current.url="api/datasources/proxy/"+this.current.id,this.kustoDbDatasource=new y(this.current,e,r,null),this.getDatabases())}r.d(e,"Datasource",function(){return y}),r.d(e,"QueryCtrl",function(){return k}),r.d(e,"ConfigCtrl",function(){return P}),r.d(e,"AnnotationsQueryCtrl",function(){return R})}],o.c=s,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=5);function o(t){if(s[t])return s[t].exports;var e=s[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}var i,s});
//# sourceMappingURL=module.js.map