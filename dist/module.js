/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","emotion","lodash","@grafana/data","app/core/config","@grafana/runtime","angular"],(function(e,t,n,r,a,o,i,l){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=12)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.create;Object.create},function(e,t,n){"use strict";function r(e){return"function"==typeof e?e():e}function a(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e}e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0,i=void 0,l=void 0,u=[];return function(){var c=r(t),p=(new Date).getTime(),d=!o||p-o>c;o=p;for(var f=arguments.length,m=Array(f),v=0;v<f;v++)m[v]=arguments[v];if(d&&n.leading)return n.accumulate?Promise.resolve(e.call(this,[m])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(m)));if(i?clearTimeout(l):i=a(),u.push(m),l=setTimeout(s.bind(this),c),n.accumulate){var h=u.length-1;return i.promise.then((function(e){return e[h]}))}return i.promise};function s(){var t=i;clearTimeout(l),Promise.resolve(n.accumulate?e.call(this,u):e.apply(this,u[u.length-1])).then(t.resolve,t.reject),u=[],i=null}}},function(e,t){e.exports=l},,function(e){e.exports=JSON.parse('{"name":"grafana-azure-data-explorer-datasource","version":"3.0.1-beta1","description":"Grafana data source for Azure Data Explorer","scripts":{"build":"grafana-toolkit plugin:build","test":"grafana-toolkit plugin:test","dev":"grafana-toolkit plugin:dev","watch":"grafana-toolkit plugin:dev --watch"},"author":"Grafana Labs","license":"Apache","devDependencies":{"@grafana/data":"latest","@grafana/e2e":"latest","@grafana/runtime":"latest","@grafana/toolkit":"latest","@grafana/ui":"latest","@testing-library/react":"^10.4.6","@types/angular":"1.6.49","@types/debounce-promise":"^3.1.2","@types/grafana":"github:CorpGlory/types-grafana.git","@types/lodash":"^4.14.158","jest-environment-jsdom-sixteen":"^1.0.3","monaco-editor":"0.17.0"},"dependencies":{"debounce-promise":"^3.1.2","react-use":"^15.3.3"}}')},function(e,t,n){"use strict";n.r(t);var r=n(4),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function l(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function u(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function l(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}function f(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var m,v=n(3),h=n.n(v),y=n(6),g=function(){function e(){}return e.prototype.parseDatabases=function(e){var t,n,r,a,o=[];if(!e||!e.data||!e.data.Tables||0===e.data.Tables.length)return o;try{for(var i=c(e.data.Tables),l=i.next();!l.done;l=i.next()){var u=l.value;try{for(var s=(r=void 0,c(u.Rows)),p=s.next();!p.done;p=s.next()){var d=p.value;o.push({text:d[5]||d[0],value:d[0]})}}catch(e){r={error:e}}finally{try{p&&!p.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o},e.prototype.parseSchemaResult=function(e){var t=e.Tables[0].Rows[0][0];return JSON.parse(t)},e}();!function(e){e.Property="property",e.Operator="operator",e.Reduce="reduce",e.FunctionParameter="functionParameter",e.GroupBy="groupBy",e.Or="or",e.And="and"}(m||(m={}));var b=n(11),w={query:"",querySource:"raw",expression:{where:{type:m.And,expressions:[]},groupBy:{type:m.And,expressions:[]},reduce:{type:m.And,expressions:[]}},pluginVersion:b.version},x={userId:"userId",login:"login",email:"email",avatarUrl:"avatarUrl",time:"time",timeEnd:"timeEnd",title:"title",text:"text",tags:"tags"};function C(e,t){if(!e)return"";return(e=(e=e.replace(/\$__([_a-zA-Z0-9]+)\(([^\)]*)\)/gi,(function(e,t,n){return"contains"===t?function(e){var t=e.indexOf(","),n=e.substring(0,t),r=e.substring(e.indexOf(",")+1);if(r&&"all"===r.toLowerCase().trim())return"1 == 1";return n.trim()+" in ("+r.trim()+")"}(n):e}))).replace(/\$(__interval|__interval_ms)/gi,(function(e,n){var r;if(!t)return e;var a=t[n];return null!==(r=null==a?void 0:a.value)&&void 0!==r?r:e}))).replace(/\$__escapeMulti\(('[^]*')\)/gi,(function(e,t){return(n=t).substring(1,n.length-1).split("','").map((function(e){return"@'"+e+"'"})).join(", ");var n}))}var O={},E=function(e,t){return u(void 0,void 0,Promise,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return O[e]?[3,2]:[4,t()];case 1:n=r.sent(),O[e]=n,r.label=2;case 2:return[2,O[e]]}}))}))};function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var T=function(e){function t(t){var n=e.call(this,t)||this;return n.backendSrv=Object(y.getBackendSrv)(),n.templateSrv=Object(y.getTemplateSrv)(),n.baseUrl="/azuredataexplorer",n.defaultOrFirstDatabase=t.jsonData.defaultDatabase,n.url=t.url,n}return o(t,e),t.prototype.filterQuery=function(e){var t,n;if(e.hide)return!1;if(void 0===e.rawMode&&e.query)return!0;if(e.rawMode)return!0;var r=null===(t=e.expression)||void 0===t?void 0:t.from;return!!r&&!!(null===(n=r.property)||void 0===n?void 0:n.name)},t.prototype.applyTemplateVariables=function(e,t){var n=C(e.query,t);return i(i({},e),{query:this.templateSrv.replace(n,t,this.interpolateVariable),database:this.templateSrv.replace(e.database,t)})},t.prototype.annotationQuery=function(t){return u(this,void 0,Promise,(function(){var n;return s(this,(function(a){return(n=t.annotation)?(n.resultFormat="table",[2,e.prototype.query.call(this,{targets:[n],range:t.range,maxDataPoints:200,interval:"10ms",intervalMs:1e4}).toPromise().then((function(e){var n;return e.state===r.LoadingState.Done&&(null===(n=e.data)||void 0===n?void 0:n.length)?function(e,t){var n,a,o,l,u,s,d,f=[];if(!e||!e.length)return f;var m=!1,v=!1,h={};try{for(var y=c(e.fields),g=y.next();!g.done;g=y.next()){h[(q=g.value).name.toLowerCase()]=q}}catch(e){n={error:e}}finally{try{g&&!g.done&&(a=y.return)&&a.call(y)}finally{if(n)throw n.error}}var b=[],w=i(i({},x),null==t?void 0:t.field);try{for(var C=c(Object.entries(w)),O=C.next();!O.done;O=C.next()){var E=p(O.value,2),S=E[0],T=E[1],j=T?T.toLowerCase():"";if(j&&h[j]){var F={key:S,field:h[j]};switch(S){case"time":m=!0;break;case"text":v=!0;break;case"tags":F.split=","}(null==t?void 0:t.regex)&&t.regex[S]&&(F.regex=new RegExp(t.regex[S])),b.push(F)}}}catch(e){o={error:e}}finally{try{O&&!O.done&&(l=C.return)&&l.call(C)}finally{if(o)throw o.error}}if(!m){if(!(k=e.fields.find((function(e){return e.type===r.FieldType.time}))))return[];b.push({key:"time",field:k})}if(!v){var k;if(!(k=e.fields.find((function(e){return e.type===r.FieldType.string}))))return[];(null===(d=null==t?void 0:t.regex)||void 0===d?void 0:d.text)?b.push({key:"time",field:k,regex:new RegExp(t.regex.text)}):b.push({key:"time",field:k})}for(var V=0;V<e.length;V++){var D={};try{for(var N=(u=void 0,c(b)),_=N.next();!_.done;_=N.next()){var q;F=(q=_.value).field.values.get(V);if(q.regex){var P=q.regex.exec(F);P&&(F=P[1]?P[1]:P[0])}q.split&&(F=F.split(",")),D[q.key]=F}}catch(e){u={error:e}}finally{try{_&&!_.done&&(s=N.return)&&s.call(N)}finally{if(u)throw u.error}}f.push(D)}return f}(e.data[0],{field:{time:"StartTime"}}):e.state===r.LoadingState.Error?(console.log("ADX Annotation ERROR???",t,e),Promise.reject({message:t.annotation.name})):[]}))]):[2,Promise.reject({message:"Query missing in annotation definition"})]}))}))},t.prototype.metricFindQuery=function(e,t){return u(this,void 0,Promise,(function(){var n=this;return s(this,(function(a){return e.match(/^databases\(\)/i)?[2,this.getDatabases()]:[2,this.getDefaultOrFirstDatabase().then((function(r){return n.buildQuery(e,t,r)})).then((function(e){return n.query({targets:[e]}).toPromise()})).then((function(e){return e.data&&e.data.length?function(e){var t=[],n=e.fields.find((function(e){return e.type===r.FieldType.string}));if(n)for(var a=0;a<n.values.length;a++)t.push({text:n.values.get(a)});return t}(e.data[0]):[]})).catch((function(e){throw console.log("There was an error",e),e}))]}))}))},t.prototype.getDatabases=function(){return u(this,void 0,Promise,(function(){var e,t;return s(this,(function(n){return e=this.baseUrl+"/v1/rest/mgmt",t={csl:".show databases"},[2,this.doRequest(e,t).then((function(e){return(new g).parseDatabases(e)}))]}))}))},t.prototype.getDefaultOrFirstDatabase=function(){return u(this,void 0,Promise,(function(){var e=this;return s(this,(function(t){return this.defaultOrFirstDatabase?[2,Promise.resolve(this.defaultOrFirstDatabase)]:[2,this.getDatabases().then((function(t){return e.defaultOrFirstDatabase=t[0].value,e.defaultOrFirstDatabase}))]}))}))},t.prototype.getSchema=function(){return u(this,void 0,Promise,(function(){var e=this;return s(this,(function(t){return[2,E(this.id+".schema.overview",(function(){var t=e.baseUrl+"/v1/rest/mgmt";return e.doRequest(t,{querySource:"schema",csl:".show databases schema as json"}).then((function(e){return(new g).parseSchemaResult(e.data)}))}))]}))}))},t.prototype.getDynamicSchema=function(e,t,n){return u(this,void 0,Promise,(function(){var r,a,o,l,u,c;return s(this,(function(s){switch(s.label){case 0:return e&&t&&Array.isArray(n)&&0!==n.length?(r=[],a="where "+n.map((function(e){return"isnotnull("+e+")"})).join(" and "),"sample 100",o="project "+n.map((function(e){return e})).join(", "),l="summarize "+n.map((function(e){return"buildschema("+e+")"})).join(", "),r.push(t),r.push(a),r.push("sample 100"),r.push(o),r.push(l),u=this.buildQuery(r.join("\n | "),{},e),[4,this.query({targets:[i(i({},u),{querySource:"schema"})]}).toPromise()]):[2,{}];case 1:return c=s.sent(),[2,j(c.data)]}}))}))},Object.defineProperty(t.prototype,"variables",{get:function(){return this.templateSrv.getVariables().map((function(e){return"$"+e.name}))},enumerable:!1,configurable:!0}),t.prototype.buildQuery=function(e,t,n){t||(t={}),t.hasOwnProperty("scopedVars")||(t.scopedVars={});var r=C(e,t.scopedVars);return i(i({},w),{refId:"adx-"+r,resultFormat:"table",rawMode:!0,query:r,database:n})},t.prototype.doRequest=function(e,t,n){var r=this;return void 0===n&&(n=1),this.backendSrv.datasourceRequest({url:this.url+e,method:"POST",data:t}).catch((function(a){if(n>0)return r.doRequest(e,t,n-1);throw a}))},t.prototype.interpolateVariable=function(e,t){return console.log("value",e),console.log("variable",t),"string"==typeof e?t.multi||t.includeAll?"'"+e+"'":e:"number"==typeof e?e:Object(v.map)(e,(function(t){return"number"==typeof e?e:"'"+t+"'"})).filter((function(e){return"''"!==e})).join(",")},t}(y.DataSourceWithBackend),j=function(e){var t,n,r,a,o={};try{for(var i=c(e),l=i.next();!l.done;l=i.next()){var u=l.value;try{for(var s=(r=void 0,c(u.fields)),p=s.next();!p.done;p=s.next()){var d=p.value,f=JSON.parse(d.values.get(0));if(null!==f){var m=[],v=d.name.replace("schema_","");F(v,f,m),o[v]=m}else console.log("error with field",d)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o},F=function e(t,n,r){var a,o;if(n)try{for(var i=c(Object.keys(n)),l=i.next();!l.done;l=i.next()){var u=l.value,s=t+"."+u;"string"!=typeof n[u]?"object"===S(n[u])&&e(s,n[u],r):r.push({Name:s,CslType:n[u]})}}catch(e){a={error:e}}finally{try{l&&!l.done&&(o=i.return)&&o.call(i)}finally{if(a)throw a.error}}else console.log("error with column",t)},k=n(0),V=n.n(k),D=n(7);function N(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var r,a,o=Object(k.useRef)(0),i=(r=Object(k.useRef)(!1),a=Object(k.useCallback)((function(){return r.current}),[]),Object(k.useEffect)((function(){return r.current=!0,function(){r.current=!1}})),a),l=Object(k.useState)(n),u=l[0],s=l[1];return[u,Object(k.useCallback)((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=++o.current;return s((function(e){return Object(D.a)(Object(D.a)({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return i()&&r===o.current&&s({value:e,loading:!1}),e}),(function(e){return i()&&r===o.current&&s({error:e,loading:!1}),e}))}),t)]}function _(e,t){void 0===t&&(t=[]);var n=N(e,t,{loading:!0}),r=n[0],a=n[1];return Object(k.useEffect)((function(){a()}),[a]),r}var q,P,M,A,I=n(1),R=n(2),$=function(){function e(e,t,n,r){this.containerDiv=e,this.defaultTimeField=t,this.getSchema=n,this.config=r,this.splitWithNewLineRegex=/[^\n]+\n?|\n/g,this.newLineRegex=/\r?\n/,this.startsWithKustoPipeRegex=/^\|\s*/g,this.kustoPipeRegexStrict=/^\|\s*$/g}return e.prototype.initMonaco=function(e){var t=this,n=this.config.bootData.user.lightTheme?"grafana-light":"vs-dark";monaco.editor.defineTheme("grafana-light",{base:"vs",inherit:!0,rules:[{token:"comment",foreground:"008000"},{token:"variable.predefined",foreground:"800080"},{token:"function",foreground:"0000FF"},{token:"operator.sql",foreground:"FF4500"},{token:"string",foreground:"B22222"},{token:"operator.scss",foreground:"0000FF"},{token:"variable",foreground:"C71585"},{token:"variable.parameter",foreground:"9932CC"},{token:"",foreground:"000000"},{token:"type",foreground:"0000FF"},{token:"tag",foreground:"0000FF"},{token:"annotation",foreground:"2B91AF"},{token:"keyword",foreground:"0000FF"},{token:"number",foreground:"191970"},{token:"annotation",foreground:"9400D3"},{token:"invalid",background:"cd3131"}],colors:{"textCodeBlock.background":"#FFFFFF"}}),monaco.languages.kusto.kustoDefaults.setLanguageSettings({includeControlCommands:!0,newlineAfterPipe:!0,useIntellisenseV2:!1}),this.codeEditor=monaco.editor.create(this.containerDiv,{value:e||"Write your query here",language:"kusto",selectionHighlight:!1,theme:n,folding:!0,lineNumbers:"off",lineHeight:16,suggestFontSize:13,dragAndDrop:!1,occurrencesHighlight:!1,minimap:{enabled:!1},renderIndentGuides:!1,wordWrap:"on"}),this.codeEditor.layout(),1===monaco.editor.getModels().length&&(this.completionItemProvider=monaco.languages.registerCompletionItemProvider("kusto",{triggerCharacters:["."," "],provideCompletionItems:this.getCompletionItems.bind(this)}),this.signatureHelpProvider=monaco.languages.registerSignatureHelpProvider("kusto",{signatureHelpTriggerCharacters:["(",")"],provideSignatureHelp:this.getSignatureHelp.bind(this)})),this.codeEditor.createContextKey("readyToExecute",!0),this.codeEditor.onDidChangeCursorSelection((function(e){t.onDidChangeCursorSelection(e)})),this.getSchema().then((function(e){e&&monaco.languages.kusto.getKustoWorker().then((function(n){var r,a=null===(r=t.codeEditor)||void 0===r?void 0:r.getModel();a&&n(a.uri).then((function(n){var r,a=Object.keys(e.Databases).length>0?Object.keys(e.Databases)[0]:"";n.setSchemaFromShowSchema(e,"https://help.kusto.windows.net",a),null===(r=t.codeEditor)||void 0===r||r.layout()}))}))}))},e.prototype.resize=function(){var e;null===(e=this.codeEditor)||void 0===e||e.layout()},e.prototype.setOnDidChangeModelContent=function(e){var t;null===(t=this.codeEditor)||void 0===t||t.onDidChangeModelContent(e)},e.prototype.disposeMonaco=function(){if(this.completionItemProvider)try{this.completionItemProvider.dispose()}catch(e){console.error("Failed to dispose the completion item provider.",e)}if(this.signatureHelpProvider)try{this.signatureHelpProvider.dispose()}catch(e){console.error("Failed to dispose the signature help provider.",e)}if(this.codeEditor)try{this.codeEditor.dispose()}catch(e){console.error("Failed to dispose the editor component.",e)}},e.prototype.addCommand=function(e,t){var n;null===(n=this.codeEditor)||void 0===n||n.addCommand(e,t,"readyToExecute")},e.prototype.getValue=function(){var e;return null===(e=this.codeEditor)||void 0===e?void 0:e.getValue()},e.prototype.toSuggestionController=function(e){return e},e.prototype.setEditorContent=function(e){var t;null===(t=this.codeEditor)||void 0===t||t.setValue(e)},e.prototype.getCompletionItems=function(e,t){var n="##### Macro that uses the selected timerange in Grafana to filter the query.\n\n- `$__timeFilter()` -> Uses the "+this.defaultTimeField+" column\n\n- `$__timeFilter(datetimeColumn)` ->  Uses the specified datetime column to build the query.",r=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column});return h.a.includes(r,"|")?h.a.includes(r.toLowerCase(),"where")?h.a.includes(e.getLineContent(t.lineNumber).toLowerCase(),"where")?[{label:"$__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:n}},{label:"$__from",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__from"},documentation:{value:"Built-in variable that returns the from value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" > $__from` "}},{label:"$__to",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__to"},documentation:{value:"Built-in variable that returns the to value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" < $__to` "}},{label:"$__timeInterval",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__timeInterval"},documentation:{value:"##### Built-in variable that returns an automatic time grain suitable for the current timerange.\n\nUsed with the bin() function - `bin("+this.defaultTimeField+", $__timeInterval)` \n\n[Grafana docs](http://docs.grafana.org/reference/templating/#the-interval-variable)"}}]:[]:[{label:"where $__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"where \\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:n}}]:[]},e.prototype.getSignatureHelp=function(e,t,n){return"$__timeFilter("!==e.getValueInRange({startLineNumber:t.lineNumber,startColumn:t.column-14,endLineNumber:t.lineNumber,endColumn:t.column})?{}:{activeParameter:0,activeSignature:0,signatures:[{label:"$__timeFilter(timeColumn)",parameters:[{label:"timeColumn",documentation:"Default is "+this.defaultTimeField+" column. Datetime column to filter data using the selected date range. "}]}]}},e.prototype.onDidChangeCursorSelection=function(e){"modelChange"===e.source&&e.reason===monaco.editor.CursorChangeReason.RecoverFromMarkers&&(" "===this.getCharAt(e.selection.positionLineNumber,e.selection.positionColumn-1)&&this.triggerSuggestions())},e.prototype.triggerSuggestions=function(){var e,t=null===(e=this.codeEditor)||void 0===e?void 0:e.getContribution("editor.contrib.suggestController");if(t){var n=this.toSuggestionController(t);n._model.cancel(),setTimeout((function(){n._model.trigger(!0)}),10)}},e.prototype.getCharAt=function(e,t){var n,r=null===(n=this.codeEditor)||void 0===n?void 0:n.getModel();if(!r)return"";if(0===r.getLineCount()||r.getLineCount()<e)return"";var a=r.getLineContent(e);return a.length<t||t<1?"":a[t-1]},e}(),B=n(5),L=n.n(B),Q=function(e){function t(t){var n=e.call(this,t)||this;return n.getStyles=Object(I.stylesFactory)((function(){return{editor:Object(R.css)(q||(q=f(["\n      width: 100%;\n      height: 350px;\n    "],["\n      width: 100%;\n      height: 350px;\n    "])))}})),n.styles=n.getStyles(),n.monacoRef=V.a.createRef(),n.state={content:t.content},window.hasOwnProperty("monaco")?setTimeout((function(){n.initMonaco()}),1):window.System.import("/"+t.pluginBaseUrl+"/libs/monaco.min.js").then((function(){setTimeout((function(){n.initMonaco()}),1)})),n}return o(t,e),t.prototype.initMonaco=function(){var e=this;this.kustoCodeEditor=new $(this.monacoRef.current,this.props.defaultTimeField,this.props.getSchema,L.a),this.kustoCodeEditor.initMonaco(this.props.content),this.kustoCodeEditor.addCommand(monaco.KeyMod.Shift|monaco.KeyCode.Enter,(function(){var t,n=null===(t=e.kustoCodeEditor)||void 0===t?void 0:t.getValue();e.props.onChange(n),e.props.onExecute()})),this.kustoCodeEditor.setOnDidChangeModelContent((function(){var t,n=null===(t=e.kustoCodeEditor)||void 0===t?void 0:t.getValue();e.props.onChange(n)})),window.onresize=function(){var t;null===(t=e.kustoCodeEditor)||void 0===t||t.resize()}},t.prototype.componentWillUnmount=function(){this.kustoCodeEditor&&this.kustoCodeEditor.disposeMonaco()},t.prototype.render=function(){return V.a.createElement("div",{id:"content",tabIndex:0,className:this.styles.editor,ref:this.monacoRef})},t}(V.a.Component),G=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],K=function(e){var t=e.query,n=W(t.resultFormat),r=Object(k.useCallback)((function(n){n&&n.value&&e.onChangeQuery(i(i({},t),{resultFormat:n.value}))}),[t.resultFormat,e.onChangeQuery]),a=U();return V.a.createElement("div",{className:a.container},V.a.createElement(I.InlineFormLabel,{className:"query-keyword",width:6},"Format as"),V.a.createElement(I.Select,{options:G,value:n,onChange:r}))},U=Object(I.stylesFactory)((function(){return{container:Object(R.css)(P||(P=f(["\n      display: flex;\n      flex-direction: row;\n      margin-right: 4px;\n    "],["\n      display: flex;\n      flex-direction: row;\n      margin-right: 4px;\n    "])))}})),W=function(e){var t=G.find((function(t){return t.value===e}));return t&&t.value?t.value:G.length>0&&G[0].value?G[0].value:"time_series"},z=["//change this to create your own time series query","","<table name>","| where $__timeFilter(Timestamp)","// | summarize count() by <group by column>, bin(Timestamp, $__timeInterval)","// | order by Timestamp asc"].join("\n"),H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onRawQueryChange=function(e){t.props.onChange(i(i({},t.props.query),{query:e,database:t.props.database}))},t}return o(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.query,r=t.datasource,a=t.lastQueryError,o=t.lastQuery,i=t.timeNotASC,l=t.schema,c=this.state,p=c.showLastQuery,d=c.showHelp,f=Z();return l?V.a.createElement("div",null,V.a.createElement(Q,{defaultTimeField:"Timestamp",pluginBaseUrl:r.meta.baseUrl,content:n.query||z,getSchema:function(){return u(e,void 0,void 0,(function(){return s(this,(function(e){return[2,l]}))}))},onChange:this.onRawQueryChange,onExecute:this.props.onRunQuery}),V.a.createElement("div",{className:f.toolbar},V.a.createElement(K,{query:n,onChangeQuery:this.props.onChange}),V.a.createElement("div",{className:"gf-form"},V.a.createElement("label",{className:"gf-form-label query-keyword",onClick:function(){return e.setState({showHelp:!d})}},"Show Help ",V.a.createElement(I.Icon,{name:d?"angle-down":"angle-right"}))),V.a.createElement("div",{className:"gf-form","ng-show":"ctrl.lastQuery"},V.a.createElement("label",{className:"gf-form-label query-keyword",onClick:function(){return e.setState({showLastQuery:!p})}},"Raw Query ",V.a.createElement(I.Icon,{name:p?"angle-down":"angle-right"}))),V.a.createElement("div",{className:"gf-form gf-form--grow"},V.a.createElement("div",{className:"gf-form-label gf-form-label--grow"}))),p&&V.a.createElement("div",{className:"gf-form"},V.a.createElement("pre",{className:"gf-form-pre"},o)),a&&V.a.createElement("div",{className:"gf-form"},V.a.createElement("pre",{className:"gf-form-pre alert alert-error"},a)),i&&V.a.createElement("div",{className:"gf-form"},V.a.createElement("pre",{className:"gf-form-pre alert alert-warning"},"Data is not sorted ascending by Time. Recommend adding an order by clause.")),d&&V.a.createElement("div",{className:"gf-form"},V.a.createElement("pre",{className:"gf-form-pre alert alert-info"},'\n  Format as Table:\n  - Can return any set of columns.\n\n  Format as Time series:\n  - Requires exactly one column of Kusto type datetime. (tip: can use Kusto\'s project-away operator to remove columns).\n  - Requires at least one value column of a number type. Each value column is considered a metric.\n  - May optionally have one or more string columns. Each string column is considered as a key=value tag pair (where the key is the column name, and the value is the value of the column for each row).\n  - A time series is returned for each value column + unique set of string column values. Each series has name of valueColumnName { stringColumnName=columnValue, ... }. If there are no string columns in the request, the name will just be valueColumnName.\n  - Example Time Series Query:\n    AzureActivity\n      | where $__timeFilter()\n      | summarize count() by Category, bin(TimeGenerated, 60min)\n      | order by TimeGenerated asc\n\n  Format as ADX Time series:\n   - Used for queries that return Kusto\'s "time series" type, such as the make-series operator\n   - Must have a datetime column named "Timestamp"\n   - Example ADX Time series query:\n    let T = range Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4\n      | extend   Person = dynamic(["Torkel", "Daniel", "Kyle", "Sofia"]) \n      | extend   Place  = dynamic(["EU",     "EU",     "US",   "EU"]) \n      | mvexpand Person, Place\n      | extend   HatInventory = rand(5) \n      | project  Timestamp, tostring(Person), tostring(Place), HatInventory;\n    T | make-series avg(HatInventory) on Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4 by Person, Place;\n\n\n  Time Macros:\n  - $__timeFilter -&gt; TimeGenerated &ge; datetime(2018-06-05T18:09:58.907Z) and TimeGenerated &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFilter(datetimeColumn) -&gt;  datetimeColumn  &ge; datetime(2018-06-05T18:09:58.907Z) and datetimeColumn &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFrom -&gt;  datetime(2018-06-05T18:09:58.907Z) [the start time of the query]\n  - $__timeTo -&gt; datetime(2018-06-05T20:09:58.907Z) [the end time of the query]\n  - $__timeInterval -&gt; 5000ms [Grafana\'s recommended bin size based on the timespan of the query, in ms]\n\n  Templating Macros:\n  - $__escapeMulti($myTemplateVar) -&gt; $myTemplateVar should be a multi-value template variables that contains illegal characters\n  - $__contains(aColumn, $myTemplateVar) -&gt; aColumn in ($myTemplateVar)\n    If using the All option, then check the Include All Option checkbox and in the Custom all value field type in: all. If All is chosen -&gt; 1 == 1\n\n  Macro Examples:\n  - ยก where $__timeFilter()\n  - | where TimeGenerated &ge; $__timeFrom() and TimeGenerated &le; $__timeTo()\n  - | summarize count() by Category, bin(TimeGenerated, $__timeInterval)'))):null},t}(k.PureComponent),Z=Object(I.stylesFactory)((function(){return{toolbar:Object(R.css)(M||(M=f(["\n      display: flex;\n      flex-direction: row;\n      margin-top: 4px;\n    "],["\n      display: flex;\n      flex-direction: row;\n      margin-top: 4px;\n    "])))}}));!function(e){e.Number="number",e.String="string",e.Boolean="boolean",e.DateTime="dateTime",e.Function="function",e.Interval="interval"}(A||(A={}));var J,X,Y,ee,te,ne,re,ae,oe,ie,le,ue,se,ce,pe,de,fe,me,ve,he,ye,ge,be=function(e){return{label:e.Name,value:e.Name,type:A.String}},we=function(e){return{value:e.Name,label:e.Name,type:A.String}},xe=function(e){return Array.isArray(e)?e.map((function(e){return{value:e.Name,label:e.Name,type:Ce(e.CslType)}})):[]},Ce=function(e){switch(e){case"real":case"int":case"long":return A.Number;case"datetime":return A.DateTime;case"bool":return A.Boolean;default:return A.String}},Oe=function(e){return V.a.createElement("div",{className:"gf-form"},V.a.createElement(I.InlineFormLabel,{className:"query-keyword",width:12},e.label),e.children)},Ee=function(e){return{name:e.value,type:e.type}},Se=function(e){var t,n=Te(),r=Fe(e),a=je(e.fields),o=null===(t=e.value)||void 0===t?void 0:t.name;return V.a.createElement("div",{className:n.container},V.a.createElement(I.Select,{width:30,onChange:r,value:o,options:e.templateVariableOptions?d([e.templateVariableOptions],a):a,placeholder:e.placeholder,menuPlacement:"bottom",allowCustomValue:e.allowCustom}))},Te=Object(I.stylesFactory)((function(){return{container:Object(R.css)(J||(J=f(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),je=function(e){return Object(k.useMemo)((function(){return e?e.map((function(e){var t;return{label:null!==(t=e.label)&&void 0!==t?t:e.value,value:e.value,type:e.type}})):[]}),[e])},Fe=function(e){return Object(k.useCallback)((function(t){var n;if(t&&"string"==typeof t.value){var r=t.value,a=e.fields.find((function(e){return e.value===r}));a||(a=null===(n=e.templateVariableOptions)||void 0===n?void 0:n.options.find((function(e){return e.value===r}))),!a&&r&&e.allowCustom&&(a={value:r,type:A.String}),a&&e.onChange({name:a.value,type:a.type})}}),[e])},ke=function(e){return(null==e?void 0:e.type)===m.Reduce},Ve=function(e){return(null==e?void 0:e.type)===m.Property},De=function(e){return(null==e?void 0:e.type)===m.Operator},Ne=function(e){return(null==e?void 0:e.type)===m.GroupBy},_e=function(e){var t,n;return(null===(n=null===(t=e)||void 0===t?void 0:t.property)||void 0===n?void 0:n.type)===A.DateTime},qe=function(e){return Array.isArray(null==e?void 0:e.value)},Pe=function(e){return!qe(e)},Me=function(e){return(null==e?void 0:e.type)===m.And},Ae=function(e){return(null==e?void 0:e.type)===m.Or},Ie=function(){function e(){}return e.prototype.build=function(){return e={defaultValue:this.buildFieldExpression()},function(t){var n,r=null!==(n=t.value)&&void 0!==n?n:e.defaultValue,a=Object(k.useCallback)((function(e){t.onChange({type:m.Property,property:e})}),[t.onChange]);return Ve(r)?V.a.createElement(Oe,{label:t.label},V.a.createElement(Se,{fields:t.fields,templateVariableOptions:t.templateVariableOptions,onChange:a,value:r.property}),t.children):null};var e},e.prototype.buildFieldExpression=function(){return{type:m.Property,property:{name:"",type:A.String}}},e}(),Re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCreate=function(e){if(e){var n=d(t.props.values,[e]);t.props.onChange({value:n,name:t.props.operator.value})}},t.onChange=function(e){Array.isArray(e)&&t.props.onChange({value:e.map((function(e){return e.value})),name:t.props.operator.value})},t.getSuggestions=function(e){return t.props.getSuggestions(e)},t}return o(t,e),t.prototype.render=function(){var e=(this.props.values||[]).map((function(e){return{label:e,value:e}}));return V.a.createElement(I.AsyncMultiSelect,{width:30,defaultOptions:[this.props.templateVariableOptions],placeholder:"Start typing to add filters...",loadOptions:this.getSuggestions,value:e,onChange:this.onChange,onCreateOption:this.onCreate,noOptionsMessage:"No options found",isClearable:!0})},t}(k.PureComponent),$e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(e){null!==e?t.props.onChange({value:""+e.value,name:t.props.operator.value}):t.props.onChange({value:"",name:t.props.operator.value})},t.onCreate=function(e){e&&t.props.onChange({value:e,name:t.props.operator.value})},t.getSuggestions=function(e){return u(t,void 0,void 0,(function(){return s(this,(function(t){return[2,this.props.getSuggestions(e)]}))}))},t}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.value,n=e.templateVariableOptions,r=t?{label:t,value:t}:void 0;return V.a.createElement(I.AsyncSelect,{width:30,placeholder:"Start typing to add filters...",loadOptions:this.getSuggestions,defaultOptions:[n],value:r,onChange:this.onChange,onCreateOption:this.onCreate,allowCustomValue:!0,backspaceRemovesValue:!0,isClearable:!0,noOptionsMessage:"No options found"})},t}(k.PureComponent),Be=[{value:!0,label:"True"},{value:!1,label:"False"}],Le=function(e){var t=Object(k.useCallback)((function(t){t&&"boolean"==typeof t.value&&e.onChange({name:e.operator.value,value:t.value})}),[e]);return V.a.createElement(I.Select,{width:15,options:Be,value:e.value,onChange:t,menuPlacement:"bottom"})},Qe=function(e,t,n,r){if(t.multipleValues)return Array.isArray(n)?Ge(e,n):Ge(e,[n]);var a=Ke(e,n);return h.a.isUndefined(a)?r:a},Ge=function(e,t){return t.reduce((function(t,n){var r=Ke(e,n);return h.a.isUndefined(r)||t.push(r),t}),[])},Ke=function(e,t){switch(e.type){case A.Boolean:return We(t,!1);case A.Number:return Ue(t,0);default:return}},Ue=function(e,t){return h.a.isNumber(e)?h.a.toNumber(e):"boolean"==typeof e?e?1:0:t},We=function(e,t){if("boolean"==typeof e)return e;if("string"==typeof e){var n=h.a.toLower(h.a.trim(e));return!!h.a.startsWith(n,"t")||!!h.a.startsWith(n,"1")}return"number"==typeof e?e>0:t},ze=function(e){return e.booleanValues?{name:e.value,value:!1}:e.multipleValues?{name:e.value,value:[]}:{name:e.value,value:""}},He=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeOperator=function(e){if(e&&e.value){var n=t.props,r=n.property,a=n.value,o=t.props.operators.find((function(t){return t.value===e.value}));if(!o||!r)return;if(!a)return void t.props.onChange(ze(o));var i=ze(o),l=i.value,u=a.value;i.value=Qe(r,o,u,l),t.props.onChange(i)}},t.onChangeValue=function(e){t.props.onChange(e)},t}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.operators,n=e.value,r=e.getSuggestions,a=e.templateVariableOptions,o=Je(),u=t.find((function(e){return e.value===(null==n?void 0:n.name)}));return V.a.createElement(V.a.Fragment,null,V.a.createElement("div",{className:o.container},V.a.createElement(I.Select,{isSearchable:!0,options:t,value:null==u?void 0:u.value,onChange:this.onChangeOperator,menuPlacement:"bottom",renderControl:V.a.forwardRef((function(e,t){e.value,e.isOpen,e.invalid;var n=l(e,["value","isOpen","invalid"]);return V.a.createElement(I.Button,i({ref:t},n,{variant:"secondary"}),(null==u?void 0:u.label)||(null==u?void 0:u.value)||"?")}))})),Ze(u,n,this.onChangeValue,r,a))},t}(k.PureComponent),Ze=function(e,t,n,r,a){var o;if(!e)return null;var i=Je();return!e.multipleValues||!qe(t)&&t?!e.booleanValues||!function(e){return"boolean"==typeof(null==e?void 0:e.value)}(t)&&t?e.multipleValues||!Pe(t)&&t?null:V.a.createElement("div",{className:i.container},V.a.createElement($e,{operator:e,value:null==t?void 0:t.value,onChange:n,getSuggestions:r,templateVariableOptions:a})):V.a.createElement("div",{className:i.container},V.a.createElement(Le,{operator:e,value:null==t?void 0:t.value,onChange:n})):V.a.createElement("div",{className:i.container},V.a.createElement(Re,{operator:e,values:null!==(o=null==t?void 0:t.value)&&void 0!==o?o:[],onChange:n,getSuggestions:r,templateVariableOptions:a}))},Je=Object(I.stylesFactory)((function(){return{container:Object(R.css)(X||(X=f(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),Xe=n(8),Ye=n.n(Xe),et=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={operators:[]},t.componentDidMount=function(){var e,n=null===(e=t.props.value)||void 0===e?void 0:e.property;n&&t.updateOperators(n)},t.updateOperators=function(e){var n,r,a=[];try{for(var o=c(t.props.operators),i=o.next();!i.done;i=o.next()){var l=i.value;l.supportTypes.includes(e.type)&&a.push(l)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return t.setState({operators:a}),a},t.onFieldChanged=function(e){var n,r,a,o=i(i({},t.props.value),{property:e}),l=t.updateOperators(e),u=null===(n=o.operator)||void 0===n?void 0:n.name,s=l.find((function(e){return e.value===u}));if(l.length&&!s){o.operator=ze(l[0]);var c=o.operator.value,p=null===(r=t.props.value)||void 0===r?void 0:r.operator.value;o.operator.value=Qe(o.property,l[0],p,c)}if(!s)return t.props.onChange(o);o.operator=ze(s);var d=o.operator.value,f=null===(a=t.props.value)||void 0===a?void 0:a.operator.value;o.operator.value=Qe(o.property,s,f,d),t.props.onChange(o)},t.onOperatorChange=function(e){t.props.onChange(i(i({},t.props.value),{operator:e}))},t.getSuggestions=Ye()((function(e){return u(t,void 0,void 0,(function(){var t,n,r,a,o,i;return s(this,(function(l){switch(l.label){case 0:return t=null===(o=this.props.value)||void 0===o?void 0:o.property.name,[4,this.props.getSuggestions(e,t)];case 1:return n=l.sent(),Array.isArray(null===(i=this.props.templateVariableOptions)||void 0===i?void 0:i.options)&&(r=this.props.templateVariableOptions.options.filter((function(t){return"string"==typeof(null==t?void 0:t.value)&&t.value.indexOf(e)>-1})),Array.prototype.push.apply(n,r)),Array.isArray(this.props.operators)&&(a=this.props.operators.filter((function(t){return"string"==typeof t.value&&t.value.indexOf(e)>-1})).map((function(e){return{label:e.value,value:e.value}})),Array.prototype.push.apply(n,a)),[2,n]}}))}))}),500,{leading:!1}),t}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.value,n=e.fields,r=e.templateVariableOptions,a=this.state.operators,o=tt(),i=(null==t?void 0:t.operator)||(null==t?void 0:t.property);return V.a.createElement("div",{className:o.container},V.a.createElement(Se,{value:null==t?void 0:t.property,fields:n,templateVariableOptions:r,onChange:this.onFieldChanged,placeholder:"Choose column..."}),i&&V.a.createElement(He,{value:null==t?void 0:t.operator,operators:a,onChange:this.onOperatorChange,getSuggestions:this.getSuggestions,property:null==t?void 0:t.property,templateVariableOptions:r}))},t}(k.PureComponent),tt=Object(I.stylesFactory)((function(){return{container:Object(R.css)(Y||(Y=f(["\n      display: flex;\n      flex-direction: row;\n    "],["\n      display: flex;\n      flex-direction: row;\n    "])))}})),nt=function(e){var t,n=Object(k.useCallback)((function(t,n){var r=e.value.expressions,a=Array.from(r);n?a.splice(t,1,n):a.splice(t,1),e.onChange(i(i({},e.value),{expressions:a}))}),[e.children,e.onChange,e.value]);return(null===(t=e.value)||void 0===t?void 0:t.expressions)?V.a.createElement(V.a.Fragment,null,e.value.expressions.map((function(t,r){return V.a.createElement(V.a.Fragment,{key:e.id+"-"+r},e.children({index:r,value:t,onChange:function(e){return n(r,e)},onAdd:function(t){return n(e.value.expressions.length,t)},onRemove:function(){return n(r)}}))}))):null},rt=Object(I.stylesFactory)((function(){var e=Object(R.css)(ee||(ee=f(["\n    display: flex;\n    flex-direction: row;\n  "],["\n    display: flex;\n    flex-direction: row;\n  "])));return{container:Object(R.css)(te||(te=f(["\n      display: flex;\n      flex-direction: column;\n    "],["\n      display: flex;\n      flex-direction: column;\n    "]))),row:e,rowWithSpacing:Object(R.css)(ne||(ne=f(["\n      ","\n      margin-top: 4px;\n    "],["\n      ","\n      margin-top: 4px;\n    "])),e),spacing:Object(R.css)(re||(re=f(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),at=function(){function e(e,t){this.value=e,this.operators=t,this.label=e,this.types=[],this.description="",this.multiple=!1,this.bool=!1}return e.prototype.withLabel=function(e){return this.label=e,this},e.prototype.withDescription=function(e){return this.description=e,this},e.prototype.supportTypes=function(e){return this.types=e,this},e.prototype.multipleValues=function(e){return this.multiple=e,this},e.prototype.booleanValues=function(e){return this.bool=e,this},e.prototype.add=function(){this.operators.push({value:this.value,supportTypes:this.types,label:this.label,description:this.description,multipleValues:this.multiple,booleanValues:this.bool})},e}(),ot=function(){function e(){this.operators=[]}return e.prototype.withOperators=function(e){var t=this;return e((function(e){return new at(e,t.operators)})),this},e.prototype.withMultipleRows=function(e){return this},e.prototype.build=function(){return e={operators:this.operators,defaultValue:this.buildOperatorExpression()},function(t){var n,r,a=rt();return 0===(null===(r=null===(n=t.value)||void 0===n?void 0:n.expressions)||void 0===r?void 0:r.length)?V.a.createElement(Oe,{label:t.label},V.a.createElement(I.Button,{variant:"secondary",onClick:function(){var n=i(i({},t.value),{expressions:[{type:m.Or,expressions:[e.defaultValue]}]});t.onChange(n)},icon:"plus"})):V.a.createElement(nt,{id:"filter-and",value:t.value,onChange:t.onChange},(function(n){var r,o;return Ae(n.value)?0===(null===(o=null===(r=n.value)||void 0===r?void 0:r.expressions)||void 0===o?void 0:o.length)?n.index>0?null:V.a.createElement(Oe,{label:t.label},V.a.createElement(I.Button,{variant:"secondary",onClick:function(){var t={type:m.Or,expressions:[e.defaultValue]};n.onChange(t)},icon:"plus"})):V.a.createElement(Oe,{label:t.label},V.a.createElement("div",{className:a.container},V.a.createElement(nt,{id:"filter-or",value:n.value,onChange:n.onChange},(function(r){if(!De(r.value))return console.log("invalid fieldandoperator-expression"),null;var o=0===r.index,u=o?a.row:a.rowWithSpacing;return V.a.createElement("div",{className:u},!o&&V.a.createElement(I.InlineFormLabel,{className:"query-keyword",width:3},"or"),V.a.createElement(et,{value:r.value,operators:e.operators,fields:t.fields,templateVariableOptions:t.templateVariableOptions,onChange:r.onChange,getSuggestions:t.getSuggestions}),V.a.createElement("div",{className:a.spacing},V.a.createElement(I.Button,{variant:"secondary",onClick:r.onRemove,icon:"minus"})),o&&V.a.createElement(I.Select,{isSearchable:!0,options:[{value:"append-row",label:"OR - include another option"},{value:"new-row",label:'AND - add a new "'+t.label+'" clause'}],onChange:function(t){return"append-row"===(null==t?void 0:t.value)?r.onAdd(e.defaultValue):"new-row"===(null==t?void 0:t.value)?n.onAdd({type:m.Or,expressions:[e.defaultValue]}):void 0},menuPlacement:"bottom",renderControl:V.a.forwardRef((function(e,t){e.value,e.isOpen,e.invalid;var n=l(e,["value","isOpen","invalid"]);return V.a.createElement(I.Button,i({ref:t},n,{variant:"secondary",icon:"plus"}))}))}))})))):null}))};var e},e.prototype.buildOperatorExpression=function(){var e=this.operators[0];return{type:m.Operator,property:this.buildFieldExpression(),operator:ze(e)}},e.prototype.buildFieldExpression=function(){return{name:"",type:A.String}},e}(),it=function(e){var t,n=p(Object(k.useState)(null!==(t=e.value)&&void 0!==t?t:""),2),r=n[0],a=n[1],o=Object(k.useCallback)((function(e){e&&e.currentTarget&&a(e.currentTarget.value)}),[a]),i=Object(k.useCallback)((function(){e.onChange({type:m.FunctionParameter,fieldType:e.fieldType,value:r,name:e.name})}),[r,e]);return V.a.createElement(I.Input,{width:20,value:r,placeholder:e.description,onChange:o,onBlur:i})},lt=function(e){var t,n,r,a,o=p(Object(k.useState)(null===(t=e.value)||void 0===t?void 0:t.property),2),i=o[0],l=o[1],u=p(Object(k.useState)(null===(n=e.value)||void 0===n?void 0:n.reduce),2),s=u[0],c=u[1],d=p(Object(k.useState)(null===(r=e.value)||void 0===r?void 0:r.parameters),2),f=d[0],v=d[1],h=ut(),y=Object(k.useCallback)((function(t){var n,r;if(l(t),!(null===(r=null===(n=e.value)||void 0===n?void 0:n.reduce)||void 0===r?void 0:r.name)){var a=e.functions.find((function(e){return"avg"===e.value}));a||(a=e.functions[0]),c({name:a.value,type:A.Function})}}),[l]),g=Object(k.useCallback)((function(e){c(e)}),[c]),b=Object(k.useCallback)((function(e){v(e)}),[v]);Object(k.useEffect)((function(){if(i&&s){var t={type:m.Reduce,property:i,reduce:s,parameters:f};e.onChange(t)}}),[i,s,f]);var w=st(s,e.functions);return V.a.createElement("div",{className:h.container},V.a.createElement(Se,{value:i,fields:e.fields,templateVariableOptions:e.templateVariableOptions,onChange:y,placeholder:"Choose column..."}),V.a.createElement(I.InlineFormLabel,{className:"query-keyword"},null!==(a=e.label)&&void 0!==a?a:"aggregate by"),V.a.createElement(Se,{value:s,fields:e.functions,onChange:g,placeholder:"Choose aggregation function..."}),w&&w.map((function(t){var n,r,a;return V.a.createElement(it,{key:t.name,name:t.name,value:null===(a=null===(r=null===(n=e.value)||void 0===n?void 0:n.parameters)||void 0===r?void 0:r.find((function(e){return e.name===t.name})))||void 0===a?void 0:a.value,description:t.description,fieldType:t.type,onChange:function(e){return b([e])}})})))},ut=Object(I.stylesFactory)((function(){return{container:Object(R.css)(ae||(ae=f(["\n      display: flex;\n      flex-direction: row;\n    "],["\n      display: flex;\n      flex-direction: row;\n    "])))}})),st=function(e,t){if(!e)return[];var n=t.find((function(t){return t.value===e.name}));return(null==n?void 0:n.parameters)||[]},ct=Object(I.stylesFactory)((function(){var e=Object(R.css)(oe||(oe=f(["\n    display: flex;\n    flex-direction: row;\n  "],["\n    display: flex;\n    flex-direction: row;\n  "])));return{container:Object(R.css)(ie||(ie=f(["\n      display: flex;\n      flex-direction: column;\n    "],["\n      display: flex;\n      flex-direction: column;\n    "]))),row:e,rowWithSpacing:Object(R.css)(le||(le=f(["\n      ","\n      margin-top: 4px;\n    "],["\n      ","\n      margin-top: 4px;\n    "])),e),spacing:Object(R.css)(ue||(ue=f(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),pt=function(){function e(e,t){this.value=e,this.functions=t,this.parameters=[],this.label=e}return e.prototype.withLabel=function(e){return this.label=e,this},e.prototype.withParameter=function(e,t,n){return this.parameters.push({name:e,type:t,description:n}),this},e.prototype.add=function(){this.functions.push({value:this.value,label:this.label,type:A.Function,parameters:this.parameters})},e}(),dt=function(){function e(){this.functions=[]}return e.prototype.withMultipleRows=function(e){return this},e.prototype.withFunctions=function(e){var t=this;return e((function(e){return new pt(e,t.functions)})),this},e.prototype.build=function(){return e={functions:this.functions,defaultValue:this.buildReduceExpression()},function(t){var n=ct();return 0===t.value.expressions.length?V.a.createElement(Oe,{label:t.label},V.a.createElement(I.Button,{variant:"secondary",onClick:function(){var n=i(i({},t.value),{expressions:[e.defaultValue]});t.onChange(n)},icon:"plus"})):V.a.createElement(Oe,{label:t.label},V.a.createElement("div",{className:n.container},V.a.createElement(nt,{id:"reduce",onChange:t.onChange,value:t.value},(function(r){if(!ke(r.value))return null;var a=0===r.index,o=a?n.row:n.rowWithSpacing;return V.a.createElement("div",{className:o},V.a.createElement(lt,{onChange:r.onChange,value:r.value,templateVariableOptions:t.templateVariableOptions,fields:t.fields,functions:e.functions}),V.a.createElement(I.Button,{className:n.spacing,variant:"secondary",onClick:r.onRemove,icon:"minus"}),a&&V.a.createElement(I.Button,{variant:"secondary",onClick:function(){return r.onAdd(e.defaultValue)},icon:"plus"}))}))))};var e},e.prototype.buildReduceExpression=function(){return{type:m.Reduce,property:this.buildProperty(A.String),reduce:this.buildProperty(A.Function)}},e.prototype.buildProperty=function(e){return{name:"",type:e}},e}(),ft=function(e){var t,n,r=p(Object(k.useState)(null===(t=e.value)||void 0===t?void 0:t.property),2),a=r[0],o=r[1],i=p(Object(k.useState)(null===(n=e.value)||void 0===n?void 0:n.interval),2),l=i[0],u=i[1],s=mt(),c=Object(k.useCallback)((function(t){o(t),t.type===A.DateTime&&u({type:A.Interval,name:e.intervals[0].value})}),[o]),d=Object(k.useCallback)((function(e){u(e)}),[u]);return Object(k.useEffect)((function(){if(a){var t={type:m.GroupBy,property:a,interval:l};e.onChange(t)}}),[a,l]),V.a.createElement("div",{className:s.container},V.a.createElement(Se,{value:a,fields:e.fields,templateVariableOptions:e.templateVariableOptions,onChange:c,placeholder:"Choose column..."}),(null==a?void 0:a.type)===A.DateTime&&V.a.createElement(Se,{value:l,fields:e.intervals,templateVariableOptions:e.templateVariableOptions,onChange:d,placeholder:"Choose interval",allowCustom:!0}))},mt=Object(I.stylesFactory)((function(){return{container:Object(R.css)(se||(se=f(["\n      display: flex;\n      flex-direction: row;\n    "],["\n      display: flex;\n      flex-direction: row;\n    "])))}})),vt=Object(I.stylesFactory)((function(){var e=Object(R.css)(ce||(ce=f(["\n    display: flex;\n    flex-direction: row;\n  "],["\n    display: flex;\n    flex-direction: row;\n  "])));return{container:Object(R.css)(pe||(pe=f(["\n      display: flex;\n      flex-direction: column;\n    "],["\n      display: flex;\n      flex-direction: column;\n    "]))),row:e,rowWithSpacing:Object(R.css)(de||(de=f(["\n      ","\n      margin-top: 4px;\n    "],["\n      ","\n      margin-top: 4px;\n    "])),e),spacing:Object(R.css)(fe||(fe=f(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}})),ht=function(){function e(e,t){this.value=e,this.intervals=t,this.label=e}return e.prototype.withLabel=function(e){return this.label=e,this},e.prototype.add=function(){this.intervals.push({value:this.value,label:this.label,type:A.Interval})},e}(),yt=function(){function e(){this.intervals=[]}return e.prototype.withMultipleRows=function(e){return this},e.prototype.withIntervals=function(e){var t=this;return e((function(e){return new ht(e,t.intervals)})),this},e.prototype.build=function(){return e={intervals:this.intervals,defaultValue:this.buildGroupByExpressions()},function(t){var n=vt();return 0===t.value.expressions.length?V.a.createElement(Oe,{label:t.label},V.a.createElement(I.Button,{variant:"secondary",onClick:function(){var n=i(i({},t.value),{expressions:[e.defaultValue]});t.onChange(n)},icon:"plus"})):V.a.createElement(Oe,{label:t.label},V.a.createElement("div",{className:n.container},V.a.createElement(nt,{id:"group-by",onChange:t.onChange,value:t.value},(function(r){if(!Ne(r.value))return null;var a=0===r.index,o=a?n.row:n.rowWithSpacing;return V.a.createElement("div",{className:o},V.a.createElement(ft,{onChange:r.onChange,value:r.value,templateVariableOptions:t.templateVariableOptions,fields:t.fields,intervals:e.intervals}),V.a.createElement(I.Button,{className:n.spacing,variant:"secondary",onClick:r.onRemove,icon:"minus"}),a&&V.a.createElement(I.Button,{variant:"secondary",onClick:function(){return r.onAdd(e.defaultValue)},icon:"plus"}))}))))};var e},e.prototype.buildGroupByExpressions=function(){return{type:m.GroupBy,property:{name:"",type:A.String}}},e}(),gt=function(e){return e.build()}(new Ie),bt=function(e){return e(new ot)}((function(e){return e.withOperators((function(e){e("==").supportTypes([A.String,A.Number]).withDescription("equal to").add(),e("==").supportTypes([A.Boolean]).withDescription("equal to").booleanValues(!0).add(),e("!=").supportTypes([A.String,A.Number]).withDescription("not equal to").add(),e("!=").supportTypes([A.Boolean]).withDescription("not equal to").booleanValues(!0).add(),e(">").supportTypes([A.Number]).withDescription("greater than").add(),e("<").supportTypes([A.Number]).withDescription("less than").add(),e("=~").supportTypes([A.String]).withDescription("equal to (case-insensitive)").add(),e("!~").supportTypes([A.String]).withDescription("not equal to (case-insensitive)").add(),e("in").supportTypes([A.String,A.Number]).withDescription("in (case-sensitive)").multipleValues(!0).add(),e("in~").supportTypes([A.String,A.Number]).withDescription("in (case-insensitive)").add(),e("!in").supportTypes([A.String,A.Number]).withDescription("not in (case-sensitive)").multipleValues(!0).add(),e("!in~").supportTypes([A.String,A.Number]).withDescription("not in (case-insensitive)").multipleValues(!0).add(),e("contains").supportTypes([A.String]).withDescription("contains substring").multipleValues(!1).add(),e("!contains").supportTypes([A.String]).withDescription("does not contain substring").multipleValues(!1).add(),e("contains_cs").supportTypes([A.String]).withDescription("contains substring (case-sensitive)").multipleValues(!1).add(),e("!contains_cs").supportTypes([A.String]).withDescription("does not contain substring (case-sensitive)").multipleValues(!1).add(),e("endswith").supportTypes([A.String]).withDescription("ends with").multipleValues(!1).add(),e("!endswith").supportTypes([A.String]).withDescription("does not end with").multipleValues(!1).add(),e("endswith_cs").supportTypes([A.String]).withDescription("ends with (case-sensitive)").multipleValues(!1).add(),e("!endswith_cs").supportTypes([A.String]).withDescription("does not end with (case-sensitive)").multipleValues(!1).add(),e("startswith").supportTypes([A.String]).withDescription("starts with").multipleValues(!1).add(),e("!startsswith").supportTypes([A.String]).withDescription("does not start with").multipleValues(!1).add(),e("startswith_cs").supportTypes([A.String]).withDescription("starts with (case-sensitive)").multipleValues(!1).add(),e("!startswith_cs").supportTypes([A.String]).withDescription("does not start with (case-sensitive)").multipleValues(!1).add(),e("matches regex").supportTypes([A.String]).withDescription("regex string matching").multipleValues(!1).add()})).withMultipleRows(!0).build()})),wt=function(e){return e(new dt)}((function(e){return e.withFunctions((function(e){e("none").withLabel("None").add(),e("sum").withLabel("Sum").add(),e("avg").withLabel("Avg").add(),e("count").withLabel("Count").add(),e("max").withLabel("Max").add(),e("min").withLabel("Min").add(),e("percentile").withLabel("Percentile").withParameter("percentileParam",A.Number,"percentile constant").add()})).withMultipleRows(!0).build()})),xt=function(e){return e(new yt)}((function(e){return e.withIntervals((function(e){e("$__timeInterval").withLabel("auto").add(),e("1m").withLabel("1 minute").add(),e("5m").withLabel("5 minutes").add(),e("15m").withLabel("15 minutes").add(),e("30m").withLabel("30 minutes").add(),e("1h").withLabel("1 hour").add(),e("6h").withLabel("6 hours").add(),e("12h").withLabel("12 hours").add(),e("1d").withLabel("1 day").add()})).withMultipleRows(!0).build()})),Ct=function(){function e(e){this.datasource=e}return e.prototype.createCacheKey=function(e){return"AdxSchemaResolver."+this.datasource.meta.id+"."+e},e.prototype.getDatabases=function(){return u(this,void 0,Promise,(function(){var e,t,n=this;return s(this,(function(r){switch(r.label){case 0:return e=this.createCacheKey("db"),[4,E(e,(function(){return n.datasource.getSchema()}))];case 1:return t=r.sent(),[2,Object.keys(t.Databases).map((function(e){return t.Databases[e]}))]}}))}))},e.prototype.getTablesForDatabase=function(e){return u(this,void 0,Promise,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this.getDatabases()];case 1:return t=r.sent(),(n=t.find((function(t){return t.Name===e})))?[2,Object.keys(n.Tables).map((function(e){return n.Tables[e]}))]:[2,[]]}}))}))},e.prototype.getColumnsForTable=function(e,t){return u(this,void 0,Promise,(function(){var n,r=this;return s(this,(function(a){return n=this.createCacheKey("db."+e+"."+t),[2,E(n,(function(){return u(r,void 0,void 0,(function(){var n,r,a,o;return s(this,(function(i){switch(i.label){case 0:return[4,this.getTablesForDatabase(e)];case 1:return n=i.sent(),(r=n.find((function(e){return e.Name===t})))?(a=r.OrderedColumns.filter((function(e){return"dynamic"===e.CslType})).map((function(e){return e.Name})),[4,this.datasource.getDynamicSchema(e,t,a)]):[2,[]];case 2:return o=i.sent(),[2,r.OrderedColumns.reduce((function(e,t){var n=o[t.Name];return Array.isArray(n)?(Array.prototype.push.apply(e,n),e):(e.push(t),e)}),[])]}}))}))}))]}))}))},e}(),Ot=function(){function e(e){void 0===e&&(e=1e4),this.limit=e,this.templateSrv=Object(y.getTemplateSrv)()}return e.prototype.fromTable=function(e,t){return void 0===t&&(t=!1),e&&Ve(e)?t?this.templateSrv.replace(e.property.name):e.property.name:""},e.prototype.query=function(e,t){var n,r;if(!e||!t)return"";var a=e.from,o=e.where,i=e.reduce,l=e.groupBy,u=this.fromTable(a);if(!u)return"";var s=xe(t),c=null!==(r=null===(n=null==s?void 0:s.find((function(e){return e.type===A.DateTime})))||void 0===n?void 0:n.value)&&void 0!==r?r:"Timestamp",p=[u];return i&&l&&this.isAggregated(l)?this.appendTimeFilter(l,c,p):p.push("where $__timeFilter("+c+")"),o&&this.appendWhere(o,p),i&&l&&this.isAggregated(l)?this.appendSummarize(i,l,t,p):i&&this.appendProject(i,c,t,p),p.push("take "+this.limit),p.join("\n| ")},e.prototype.appendTimeFilter=function(e,t,n){var r=t;e&&(r=this.getGroupByFields(e).dateTimeField||t),n.push("where $__timeFilter("+r+")")},e.prototype.appendProject=function(e,t,n,r){var a,o,i,l=this,u="project ",s=t,p=[];try{for(var d=c(e.expressions),f=d.next();!f.done;f=d.next()){var m=f.value;ke(m)&&(null===(i=m.property)||void 0===i?void 0:i.name)&&(m.property.type===A.DateTime?s=m.property.name:p.push(m.property.name))}}catch(e){a={error:e}}finally{try{f&&!f.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}p.length>0&&(u+=[s].concat(p).map((function(e){return l.castIfDynamic(e,n)})).join(", "),r.push(u));var v="order by "+this.castIfDynamic(s,n)+" asc";r.push(v)},e.prototype.createWhere=function(e){var t="";if(e.property)return t+=e.property.name+" ",e.operator?(t+=e.operator.name+" ",qe(e.operator)?(t+="(",t+=e.operator.value.map(this.processMultiValueFilter.bind(this)).join(", "),t+=")"):Pe(e.operator)&&(e.property.type!==A.String||this.isQuotedString(e.operator.value)?t+=e.operator.value:t+="'"+e.operator.value+"'"),t):t},e.prototype.processMultiValueFilter=function(e){return this.isVariable(e)?e:"'"+e+"'"},e.prototype.appendWhere=function(e,t){var n=this;if(Me(e))return e.expressions.map((function(e){return n.appendWhere(e,t)}));if(Ae(e)){var r=e.expressions.map((function(e){if(De(e))return n.createWhere(e)})).filter((function(e){return!!e}));r.length>0&&t.push("where "+r.join(" or "))}else if(De(e)){var a=this.createWhere(e);a&&t.push("where "+a)}else;},e.prototype.appendSummarize=function(e,t,n,r){var a,o,i,l,u=this,s="summarize ",p=[];try{for(var d=c(e.expressions),f=d.next();!f.done;f=d.next()){var m=f.value;if(ke(m)&&"none"!==(null===(i=null==m?void 0:m.reduce)||void 0===i?void 0:i.name)&&(null===(l=null==m?void 0:m.property)||void 0===l?void 0:l.name)){var v=this.castIfDynamic(m.property.name,n);(null==m?void 0:m.parameters)&&(null==m?void 0:m.parameters.length)>0?p.push(m.reduce.name+"("+v+", "+m.parameters.map((function(e){return e.value})).join(", ")+")"):p.push(m.reduce.name+"("+v+")")}}}catch(e){a={error:e}}finally{try{f&&!f.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}s+=p.join(", ");var h=this.getGroupByFields(t);if(h.dateTimeField&&(s+=" by bin("+h.dateTimeField+", "+h.interval+")"),h.groupByFields.length>0&&(h.dateTimeField?s+=",":s+=" by ",s+=h.groupByFields.map((function(e){return u.castIfDynamic(e,n)})).join(", ")),r.push(s),h.dateTimeField){var y="order by "+this.castIfDynamic(h.dateTimeField,n)+" asc";r.push(y)}},e.prototype.castIfDynamic=function(e,t){if(!e||e.indexOf(".")<0)return e;var n=t.find((function(t){return t.Name===e})),r=null==n?void 0:n.CslType;if(!r)return e;var a=e.split(".");return a.reduce((function(e,t,n){return e?n+1===a.length?"to"+r+"("+e+"."+t+")":"todynamic("+e+"."+t+")":"todynamic("+t+")"}),"")},e.prototype.getGroupByFields=function(e){var t,n,r="",a="",o=[];try{for(var i=c(e.expressions),l=i.next();!l.done;l=i.next()){var u=l.value;Ne(u)&&_e(u)&&u.interval?(r=u.property.name,a=u.interval.name):Ne(u)&&!_e(u)&&u.property&&u.property.name&&o.push(u.property.name)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{dateTimeField:r,interval:a,groupByFields:o}},e.prototype.isAggregated=function(e){return e.expressions.length>0},e.prototype.isQuotedString=function(e){return!("'"!==e[0]&&'"'!==e[0]||"'"!==e[e.length-1]&&'"'!==e[e.length-1])},e.prototype.isVariable=function(e){var t,n,r=this.templateSrv.getVariables();try{for(var a=c(r),o=a.next();!o.done;o=a.next()){if("$"+o.value.name===e)return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},e}(),Et=function(){function e(e,t,n,r){void 0===t&&(t=[]),this.datasource=e,this.columnSchema=t,this.database=n,this.table=r}return e.prototype.search=function(e,t){return u(this,void 0,Promise,(function(){var n,r,a,o;return s(this,(function(l){switch(l.label){case 0:return e&&t&&this.table&&this.database?((n=[]).push(this.table),n.push("where "+t+' contains "'+e+'"'),n.push("distinct "+this.castIfDynamic(t,this.columnSchema)),n.push("take 251"),r=n.join("\n| "),a=i(i({},w),{refId:"adx-"+r,database:this.database,rawMode:!0,query:r,resultFormat:"table",querySource:"autocomplete"}),[4,this.datasource.query({targets:[a]}).toPromise()]):[2,[]];case 1:return o=l.sent(),Array.isArray(null==o?void 0:o.data)&&0!==o.data.length?[2,o.data[0].fields[0].values.toArray()]:[2,[]]}}))}))},e.prototype.castIfDynamic=function(e,t){if(!e||e.indexOf(".")<0)return e;var n=t.find((function(t){return t.Name===e})),r=null==n?void 0:n.CslType;if(!r)return e;var a=e.split(".");return a.reduce((function(e,t,n){return e?n+1===a.length?"to"+r+"("+e+"."+t+")":"todynamic("+e+"."+t+")":"todynamic("+t+")"}),"")},e}(),St=function(e){var t=Object(I.useTheme)(),n=Ft(t);return V.a.createElement("div",{className:n.container},V.a.createElement("div",{className:n.icon},V.a.createElement(I.Icon,{className:"spin-clockwise",name:"sync"})),V.a.createElement("span",null,"One moment, your schema is loading ..."))},Tt=function(e){var t=Object(I.useTheme)(),n=Ft(t);return V.a.createElement("div",{className:n.container},V.a.createElement("div",{className:n.icon},V.a.createElement(I.Icon,{name:"exclamation-triangle",className:n.error})),V.a.createElement("span",{className:n.error},e.message))},jt=function(e){var t=Object(I.useTheme)(),n=Ft(t);return V.a.createElement("div",{className:n.container},V.a.createElement("div",{className:n.icon},V.a.createElement(I.Icon,{name:"exclamation-triangle",className:n.warning})),V.a.createElement("span",{className:n.warning},e.message))},Ft=Object(I.stylesFactory)((function(e){return{container:Object(R.css)(me||(me=f(["\n      margin-top: 10px;\n      display: flex;\n      flex-direction: row;\n    "],["\n      margin-top: 10px;\n      display: flex;\n      flex-direction: row;\n    "]))),icon:Object(R.css)(ve||(ve=f(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "]))),error:Object(R.css)(he||(he=f(["\n      color: ",";\n    "],["\n      color: ",";\n    "])),e.colors.formInputBorderInvalid),warning:Object(R.css)(ye||(ye=f(["\n      color: ",";\n    "],["\n      color: ",";\n    "])),e.palette.yellow)}})),kt=new Ot,Vt=function(e){var t,n,r,a,o,l,c,p,d,f,m,v=e.query,h=e.database,y=e.datasource,g=e.schema,b=W(v.resultFormat),x=Pt(g,h),C=qt(x,v),O=_((function(){return u(void 0,void 0,void 0,(function(){return s(this,(function(e){return C&&C.property?[2,Mt(y,h,C)]:[2,[]]}))}))}),[y.id,h,C]),E=Object(k.useCallback)((function(e,t){return u(void 0,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=null==C?void 0:C.property.name,[4,new Et(y,O.value,h,n).search(e,t)];case 1:return[2,r.sent().map((function(e){return{value:e,label:e}}))]}}))}))}),[y,h,C,O.value]),S=_t(O.value),T=Nt(S),j=function(t){return u(void 0,void 0,void 0,(function(){var n,r;return s(this,(function(a){switch(a.label){case 0:return Ve(t)&&C?[4,Mt(y,h,t)]:[2];case 1:return n=a.sent(),r=i(i({},w.expression),{from:t}),e.onChangeQuery(i(i({},e.query),{resultFormat:b,database:h,expression:r,query:kt.query(r,n)})),[2]}}))}))},F=Object(k.useCallback)((function(t){var n=i(i({},e.query.expression),{from:C,where:t});e.onChangeQuery(i(i({},e.query),{resultFormat:b,database:h,expression:n,query:kt.query(n,O.value)}))}),[e.onChangeQuery,e.query,O.value,b]),D=Object(k.useCallback)((function(t){var n=i(i({},e.query.expression),{reduce:t});e.onChangeQuery(i(i({},e.query),{resultFormat:b,expression:n,query:kt.query(n,O.value)}))}),[e.onChangeQuery,e.query,O.value,b]),N=Object(k.useCallback)((function(t){var n=i(i({},e.query.expression),{groupBy:t});e.onChangeQuery(i(i({},e.query),{resultFormat:b,expression:n,query:kt.query(n,O.value)}))}),[e.onChangeQuery,e.query,O.value,b]);if(O.loading)return V.a.createElement(V.a.Fragment,null,V.a.createElement(gt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:C,fields:x,onChange:j}),V.a.createElement(St,null));if(O.error)return V.a.createElement(V.a.Fragment,null,V.a.createElement(gt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:C,fields:x,onChange:j}),V.a.createElement(Tt,{message:"Could not load table schema: "+(null===(t=O.error)||void 0===t?void 0:t.message)}));if(0===(null===(n=O.value)||void 0===n?void 0:n.length))return V.a.createElement(V.a.Fragment,null,V.a.createElement(gt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:C,fields:x,onChange:j}),V.a.createElement(jt,{message:"Table schema loaded successfully but without any columns"}));var q=Dt();return V.a.createElement(V.a.Fragment,null,V.a.createElement(gt,{templateVariableOptions:e.templateVariableOptions,label:"From",value:C,fields:x,onChange:j},V.a.createElement(K,{onChangeQuery:e.onChangeQuery,query:v})),V.a.createElement(bt,{templateVariableOptions:e.templateVariableOptions,label:"Where (filter)",value:null!==(a=null===(r=v.expression)||void 0===r?void 0:r.where)&&void 0!==a?a:null===(o=w.expression)||void 0===o?void 0:o.where,fields:S,onChange:F,getSuggestions:E}),V.a.createElement(wt,{templateVariableOptions:e.templateVariableOptions,label:"Value columns",value:null!==(c=null===(l=v.expression)||void 0===l?void 0:l.reduce)&&void 0!==c?c:null===(p=w.expression)||void 0===p?void 0:p.reduce,fields:S,onChange:D,getSuggestions:E}),V.a.createElement(xt,{templateVariableOptions:e.templateVariableOptions,label:"Group by (summarize)",value:null!==(f=null===(d=v.expression)||void 0===d?void 0:d.groupBy)&&void 0!==f?f:null===(m=w.expression)||void 0===m?void 0:m.groupBy,fields:T,onChange:N,getSuggestions:E}),V.a.createElement("div",{className:q.query},V.a.createElement(I.TextArea,{cols:80,rows:8,value:e.query.query,disabled:!0})))},Dt=Object(I.stylesFactory)((function(){return{query:Object(R.css)(ge||(ge=f(["\n      margin-top: 12px;\n    "],["\n      margin-top: 12px;\n    "])))}})),Nt=function(e){return Object(k.useMemo)((function(){return e.filter((function(e){return e.type===A.DateTime||A.String}))}),[e])},_t=function(e){return Object(k.useMemo)((function(){return e?xe(e):[]}),[e])},qt=function(e,t){var n;return Object(k.useMemo)((function(){var n,r,a=null===(r=null===(n=t.expression)||void 0===n?void 0:n.from)||void 0===r?void 0:r.property.name,o=e.find((function(e){return e.value===a}));return o?{type:m.Property,property:Ee(o)}:e.length>0?{type:m.Property,property:Ee(e[0])}:void 0}),[e,null===(n=t.expression)||void 0===n?void 0:n.from])},Pt=function(e,t){return Object(k.useMemo)((function(){var n,r;if(!e||!e.Databases)return[];var a=e.Databases[t];if(!a||!a.Tables)return[];var o=[];try{for(var i=c(Object.keys(a.Tables)),l=i.next();!l.done;l=i.next()){var u=l.value,s=a.Tables[u];o.push(be(s))}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}),[t,e])};function Mt(e,t,n){return u(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,new Ct(e).getColumnsForTable(t,n.property.name)];case 1:return[2,r.sent()]}}))}))}var At,It=function(e){var t=p(Object(k.useState)(!1),2),n=t[0],r=t[1],a=Object(k.useCallback)((function(){e.dirty&&"visual"!==e.editorMode?r(!0):e.onToggleEditorMode()}),[r,e.onToggleEditorMode,e.dirty,e.editorMode]),o=Rt();return V.a.createElement(Oe,{label:"Database"},V.a.createElement(I.Select,{width:30,options:e.databases,placeholder:"Select database",value:e.database,onChange:function(t){t&&t.value&&e.onChangeDatabase(t.value)}}),"raw"===e.editorMode&&V.a.createElement(V.a.Fragment,null,V.a.createElement("div",{className:o.spacing}),V.a.createElement("label",{className:"gf-form-label"},"(Run Query: Shift+Enter, Trigger Suggestion: Ctrl+Space)")),V.a.createElement("div",{className:"gf-form gf-form--grow"},V.a.createElement("div",{className:"gf-form-label--grow"})),V.a.createElement(I.Button,{variant:"secondary",onClick:a},"visual"===e.editorMode?"Edit KQL":"Switch to builder"),V.a.createElement("div",{className:o.spacing}),V.a.createElement(I.Button,{variant:e.dirty?"primary":"secondary",onClick:e.onRunQuery},"Run Query"),V.a.createElement(I.ConfirmModal,{isOpen:n,title:"Are you sure?",body:"You might loose manual changes done to the query if you go back to the visual builder.",confirmText:"Yes, I am sure.",dismissText:"No, continue edit query manually.",icon:"exclamation-triangle",onConfirm:function(){r(!1),e.onToggleEditorMode()},onDismiss:function(){return r(!1)}}))},Rt=Object(I.stylesFactory)((function(){return{spacing:Object(R.css)(At||(At=f(["\n      margin-right: 4px;\n    "],["\n      margin-right: 4px;\n    "])))}}));function $t(e){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Bt=function(e){var t,n;return"string"==typeof(null===(n=null===(t=null==e?void 0:e.from)||void 0===t?void 0:t.expression)||void 0===n?void 0:n.value)},Lt=function(e){var t,n,r,a,o,l,u,s,c,p,d,f,m,v,h;if(!e)return w.expression;var y=i({},w.expression);return"string"==typeof(null===(n=null===(t=null==e?void 0:e.from)||void 0===t?void 0:t.expression)||void 0===n?void 0:n.value)&&(y.from=Wt(null===(r=null==e?void 0:e.from)||void 0===r?void 0:r.expression)),Array.isArray(null===(o=null===(a=null==e?void 0:e.where)||void 0===a?void 0:a.expression)||void 0===o?void 0:o.expressions)&&(y.where=Qt(null===(u=null===(l=null==e?void 0:e.where)||void 0===l?void 0:l.expression)||void 0===u?void 0:u.expressions)),Array.isArray(null===(c=null===(s=null==e?void 0:e.reduce)||void 0===s?void 0:s.expression)||void 0===c?void 0:c.expressions)&&(y.reduce=Qt(null===(d=null===(p=null==e?void 0:e.reduce)||void 0===p?void 0:p.expression)||void 0===d?void 0:d.expressions)),Array.isArray(null===(m=null===(f=null==e?void 0:e.groupBy)||void 0===f?void 0:f.expression)||void 0===m?void 0:m.expressions)&&(y.groupBy=Qt(null===(h=null===(v=null==e?void 0:e.groupBy)||void 0===v?void 0:v.expression)||void 0===h?void 0:h.expressions)),y},Qt=function(e){return Array.isArray(e)?{type:m.And,expressions:e.map(Gt).filter((function(e){return!!e}))}:{type:m.And,expressions:[]}},Gt=function(e){switch(null==e?void 0:e.type){case"fieldAndOperator":return zt(e);case"field":return Wt(e);case"reduce":return Ut(e);case"groupBy":return Kt(e);default:return}},Kt=function(e){if("groupBy"===(null==e?void 0:e.type)&&"object"===$t(null==e?void 0:e.field))return"object"!==$t(null==e?void 0:e.interval)?{type:m.GroupBy,property:Ht(null==e?void 0:e.field)}:{type:m.GroupBy,property:Ht(null==e?void 0:e.field),interval:Ht(null==e?void 0:e.interval)}},Ut=function(e){if("reduce"===(null==e?void 0:e.type)&&"object"===$t(null==e?void 0:e.field))return Array.isArray(null==e?void 0:e.parameters)?{type:m.Reduce,property:Ht(null==e?void 0:e.field),reduce:Ht(null==e?void 0:e.reduce),parameters:e.parameters}:{type:m.Reduce,property:Ht(null==e?void 0:e.field),reduce:Ht(null==e?void 0:e.reduce)}},Wt=function(e){if("field"===(null==e?void 0:e.type)&&"string"==typeof(null==e?void 0:e.value))return{type:m.Property,property:Ht(e)}},zt=function(e){var t,n,r,a,o,i,l,u;if("string"==typeof(null===(t=null==e?void 0:e.field)||void 0===t?void 0:t.value)&&"string"==typeof(null===(r=null===(n=null==e?void 0:e.operator)||void 0===n?void 0:n.operator)||void 0===r?void 0:r.value))return{type:m.Operator,property:Ht(null==e?void 0:e.field),operator:{name:null===(o=null===(a=null==e?void 0:e.operator)||void 0===a?void 0:a.operator)||void 0===o?void 0:o.value,value:null!==(l=null===(i=null==e?void 0:e.operator)||void 0===i?void 0:i.value)&&void 0!==l?l:null===(u=null==e?void 0:e.operator)||void 0===u?void 0:u.values}}},Ht=function(e){return{type:Zt(e.fieldType),name:e.value}},Zt=function(e){switch(e){case"boolean":return A.Boolean;case"dateTime":return A.DateTime;case"function":return A.Function;case"number":return A.Number;case"interval":return A.Interval;default:return A.String}};function Jt(e){var t;return!(void 0!==e.rawMode||!e.query||(null===(t=e.expression)||void 0===t?void 0:t.from))||(e.rawMode||!1)}var Xt=function(e,t){return Object(k.useMemo)((function(){var n=e.find((function(e){return e.value===t.database}));return n?n.value:e.length>0?e[0].value:""}),[e,t.database])},Yt=function(e){return Object(k.useMemo)((function(){var t,n,r=[];if(!e||!e.Databases)return r;try{for(var a=c(Object.keys(e.Databases)),o=a.next();!o.done;o=a.next()){var i=o.value,l=e.Databases[i];r.push(we(l))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r}),[e])},en=function(e){return Object(k.useMemo)((function(){var t,n,r;return null!==(r=null===(n=null===(t=null==e?void 0:e.series[0])||void 0===t?void 0:t.meta)||void 0===n?void 0:n.executedQueryString)&&void 0!==r?r:""}),[e])},tn=function(e,t){return Object(k.useMemo)((function(){return e!==t}),[e,t])},nn=function(e){return Object(k.useMemo)((function(){var t,n,r,a=null===(r=null===(n=null===(t=null==e?void 0:e.series[0])||void 0===t?void 0:t.meta)||void 0===n?void 0:n.custom)||void 0===r?void 0:r.KustoError;return(null==e?void 0:e.error)&&!a?e.error.message?""+e.error.message:""+e.error:a}),[e])},rn=function(e){return Object(k.useMemo)((function(){return{label:"Template Variables",expanded:!1,options:e.variables.map((function(e){return{label:e,value:e}}))}}),[e.id])};var an=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/,on=function(){function e(e){this.major=0,this.minor=0,this.patch=0,this.meta="";var t=an.exec(e);t&&(this.major=Number(t[1]),this.minor=Number(t[2]||0),this.patch=Number(t[3]||0),this.meta=t[4])}return e.prototype.isGtOrEq=function(t){for(var n=new e(t),r=0;r<this.comparable.length;++r){if(this.comparable[r]>n.comparable[r])return!0;if(this.comparable[r]<n.comparable[r])return!1}return!0},e.prototype.isValid=function(){return Object(v.isNumber)(this.major)},Object.defineProperty(e.prototype,"comparable",{get:function(){return[this.major,this.minor,this.patch]},enumerable:!1,configurable:!0}),e}();var ln=function(){function e(e){var t=this;this.$scope=e,this.loading=!1,this.hasRequiredGrafanaVersion=this.hasMinVersion(),this.suggestUrl="https://yourcluster.kusto.windows.net",e.getSuggestUrls=function(){return[t.suggestUrl]},this.databases=[],this.current.id&&(this.current.url="api/datasources/proxy/"+this.current.id,this.datasource=new T(this.current),this.getDatabases())}return e.$inject=["$scope"],e.prototype.getDatabases=function(){var e=this;return this.datasource?(this.loading=!0,this.datasource.getDatabases().then((function(t){e.loading=!1,e.databases=t,!e.current.jsonData.defaultDatabase&&t.length&&(e.current.jsonData.defaultDatabase=t[0].value),e.$scope.$digest()}))):[]},e.prototype.hasMinVersion=function(){return e=L.a.buildInfo.latestVersion,t="5.3",new on(e).isGtOrEq(t)||"5.3.0-beta1"===L.a.buildInfo.version||"5.3.0-pre1"===L.a.buildInfo.version;var e,t},e.prototype.showMinVersionWarning=function(){return!this.hasRequiredGrafanaVersion},e.templateUrl="partials/config.html",e}(),un=n(9);function sn(e,t,n){var r=t.find("#content")[0];function a(e,t){var n=new $(e,t.defaultTimeField,t.getSchema,L.a);n.initMonaco(t.content),n.addCommand(monaco.KeyMod.Shift|monaco.KeyCode.Enter,(function(){var e=n.getValue();t.content=e,t.onChange()})),t.$watch("content",(function(e,r){var a=n.getValue();e!==a&&e!==r&&t.$$postDigest((function(){n.setEditorContent(e)}))})),n.setOnDidChangeModelContent((function(){t.$apply((function(){var e=n.getValue();t.content=e}))})),t.$on("$destroy",(function(){n.disposeMonaco()})),window.onresize=function(){n.resize()}}window.hasOwnProperty("monaco")?setTimeout((function(){a(r,e)}),100):window.System.import("/"+e.pluginBaseUrl+"/libs/monaco.min.js").then((function(){setTimeout((function(){a(r,e)}),100)})),r.onblur=function(){e.onChange()},r.onkeydown=function(e){if("Escape"===e.key)return e.stopPropagation(),!0}}n.n(un).a.module("grafana.controllers").directive("kustoMonacoEditor",(function(){return{restrict:"E",template:'<div id="content" tabindex="0" style="width: 100%; height: 150px"></div>',scope:{content:"=",onChange:"&",getSchema:"&",defaultTimeField:"@",pluginBaseUrl:"@"},link:sn}}));var cn=function(){function e(){this.showHelp=!1,this.defaultQuery='<your table>\n| where $__timeFilter() \n| project TimeGenerated, Text=YourTitleColumn, Tags="tag1,tag2"',this.annotation.query=this.annotation.query||this.defaultQuery,this.annotation.resultFormat="table",this.databases=this.getDatabases()}return e.prototype.getDatabases=function(){var e=this;return this.databases&&this.databases.length>0?this.databases:this.datasource.getDatabases().then((function(t){return e.databases=t,t.length>0&&!e.annotation.database&&(e.annotation.database=t[0].value),e.databases})).catch((function(e){}))},e.templateUrl="partials/annotations.editor.html",e}();n.d(t,"plugin",(function(){return pn}));var pn=new r.DataSourcePlugin(T).setConfigCtrl(ln).setAnnotationQueryCtrl(cn).setQueryEditor((function(e){var t=e.datasource,n=e.query,r=en(e.data),a=nn(e.data),o=tn(e.query.query,r),l=_((function(){return t.getSchema()}),[t.id]),u=Yt(l.value),s=Xt(u,n),c=rn(t),p=function(e){var t;if(void 0===e.query.rawMode&&e.query.query&&!(null===(t=e.query.expression)||void 0===t?void 0:t.from))return!0;return e.query.rawMode||!1}(e);Object(k.useEffect)((function(){(function(e){return!!e&&(!e.pluginVersion||(!e.querySource||!!Bt(e.expression)))})(n)&&(e.onChange(function(e){return i(i(i({},w),e),{rawMode:Jt(e),pluginVersion:w.pluginVersion,expression:(t=e.expression,Bt(t)?Lt(t):null!=t?t:w.expression)});var t}(n)),e.onRunQuery())}),[]);var d=Object(k.useCallback)((function(t){e.onChange(i(i({},e.query),{database:t}))}),[e.onChange,e.query]),f=Object(k.useCallback)((function(){e.onChange(i(i({},e.query),{rawMode:!p,querySource:p?"visual":"raw"}))}),[e.onChange,e.query]);if(l.loading)return V.a.createElement(St,null);if(l.error)return V.a.createElement("div",{className:"gf-form"},V.a.createElement("pre",{className:"gf-form-pre alert alert-error"},"Could not load datasource schema: ",l.error));if(0===u.length)return V.a.createElement("div",{className:"gf-form"},V.a.createElement("pre",{className:"gf-form-pre alert alert-warning"},"Datasource schema loaded but without any databases and tables, please try again.."));var m=p?"raw":"visual";return V.a.createElement(V.a.Fragment,null,a&&V.a.createElement("div",{className:"gf-form"},V.a.createElement("pre",{className:"gf-form-pre alert alert-warning"},"Failed to execute query: ",a)),V.a.createElement(It,{onRunQuery:e.onRunQuery,onToggleEditorMode:f,editorMode:m,onChangeDatabase:d,database:s,databases:u,dirty:o}),"raw"===m&&V.a.createElement(H,i({},e,{schema:l.value,templateVariableOptions:c,lastQuery:r,database:s})),"visual"===m&&V.a.createElement(Vt,{datasource:t,database:s,onChangeQuery:e.onChange,query:n,schema:l.value,templateVariableOptions:c}))}))}])}));
//# sourceMappingURL=module.js.map